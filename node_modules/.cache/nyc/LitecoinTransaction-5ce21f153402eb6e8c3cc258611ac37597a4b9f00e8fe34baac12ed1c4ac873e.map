{"version":3,"file":"/Users/qroc/Code/hapi/chaindefuser/utxo-lib/src/bitgo/litecoin/LitecoinTransaction.ts","sources":["/Users/qroc/Code/hapi/chaindefuser/utxo-lib/src/bitgo/litecoin/LitecoinTransaction.ts"],"names":[],"mappings":";;;AAAA,+DAA2E;AAE3E,wDAAqD;AACrD,6CAA+D;AAI/D;;;GAGG;AACH,MAAa,mBAA8D,SAAQ,iCAAwB;IAGzG,YAAY,OAAgB,EAAE,EAAyC,EAAE,UAAgC;QACvG,KAAK,CAAC,OAAO,EAAE,EAAE,EAAE,UAAU,CAAC,CAAC;QAE/B,IAAI,CAAC,IAAA,qBAAU,EAAC,OAAO,CAAC,EAAE,CAAC;YACzB,MAAM,IAAI,KAAK,CAAC,iBAAiB,CAAC,CAAC;QACrC,CAAC;IACH,CAAC;IAES,MAAM,CAAC,cAAc,CAC7B,OAAgB,EAChB,WAAkD,EAClD,UAAgC;QAEhC,OAAO,IAAI,mBAAmB,CAAU,OAAO,EAAE,WAAW,EAAE,UAAU,CAAC,CAAC;IAC5E,CAAC;IAED,KAAK,CAAwC,UAAgC;QAC3E,OAAO,IAAI,mBAAmB,CAAM,IAAI,CAAC,OAAO,EAAE,IAAI,EAAE,UAAU,CAAC,CAAC;IACtE,CAAC;IAED,MAAM,CAAC,UAAU,CACf,MAAc,EACd,QAAiB,EACjB,aAAkC,QAAQ,EAC1C,OAAyB;QAEzB,IAAI,CAAC,OAAO,EAAE,CAAC;YACb,MAAM,IAAI,KAAK,CAAC,sBAAsB,CAAC,CAAC;QAC1C,CAAC;QAED,MAAM,YAAY,GAAG,IAAI,0BAAY,CAAC,MAAM,CAAC,CAAC;QAC9C,MAAM,SAAS,GAAG,YAAY,CAAC,SAAS,EAAE,CAAC;QAC3C,MAAM,MAAM,GAAG,YAAY,CAAC,SAAS,EAAE,CAAC;QACxC,MAAM,IAAI,GAAG,YAAY,CAAC,SAAS,EAAE,CAAC;QAEtC,IACE,MAAM,KAAK,mBAAmB,CAAC,2BAA2B;YAC1D,IAAI,KAAK,mBAAmB,CAAC,mBAAmB,EAChD,CAAC;YACD,kIAAkI;YAClI,MAAM,YAAY,GAAG,IAAI,0BAAY,CAAC,MAAM,CAAC,WAAW,CAAC,MAAM,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC;YAC7E,YAAY,CAAC,WAAW,CAAC,SAAS,CAAC,CAAC;YACpC,YAAY,CAAC,UAAU,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,EAAE,MAAM,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC;YAC5D,YAAY,CAAC,UAAU,CAAC,MAAM,CAAC,KAAK,CAAC,MAAM,CAAC,MAAM,GAAG,CAAC,EAAE,MAAM,CAAC,MAAM,CAAC,CAAC,CAAC;YACxE,OAAO,KAAK,CAAC,UAAU,CAAC,YAAY,CAAC,MAAM,EAAE,QAAQ,EAAE,UAAU,EAAE,OAAO,CAAC,CAAC;QAC9E,CAAC;QACD,OAAO,KAAK,CAAC,UAAU,CAAC,MAAM,EAAE,QAAQ,EAAE,UAAU,EAAE,OAAO,CAAC,CAAC;IACjE,CAAC;;AAlDH,kDAmDC;AAlDQ,uCAAmB,GAAG,IAAI,CAAC","sourcesContent":["import { BufferReader, BufferWriter } from 'bitcoinjs-lib/src/bufferutils';\n\nimport { UtxoTransaction } from '../UtxoTransaction';\nimport { isLitecoin, Network, networks } from '../../networks';\n\nexport type LitecoinNetwork = typeof networks.litecoin | typeof networks.litecoinTest;\n\n/**\n * We only care about reading a transaction that can have a potentially different advanced transaction flag,\n * but we dont need to write one.\n */\nexport class LitecoinTransaction<TNumber extends number | bigint = number> extends UtxoTransaction<TNumber> {\n  static MWEB_PEGOUT_TX_FLAG = 0x08;\n\n  constructor(network: Network, tx?: LitecoinTransaction<bigint | number>, amountType?: 'bigint' | 'number') {\n    super(network, tx, amountType);\n\n    if (!isLitecoin(network)) {\n      throw new Error(`invalid network`);\n    }\n  }\n\n  protected static newTransaction<TNumber extends number | bigint = number>(\n    network: Network,\n    transaction?: LitecoinTransaction<number | bigint>,\n    amountType?: 'number' | 'bigint'\n  ): LitecoinTransaction<TNumber> {\n    return new LitecoinTransaction<TNumber>(network, transaction, amountType);\n  }\n\n  clone<TN2 extends bigint | number = TNumber>(amountType?: 'number' | 'bigint'): LitecoinTransaction<TN2> {\n    return new LitecoinTransaction<TN2>(this.network, this, amountType);\n  }\n\n  static fromBuffer<TNumber extends number | bigint = number>(\n    buffer: Buffer,\n    noStrict: boolean,\n    amountType: 'number' | 'bigint' = 'number',\n    network?: LitecoinNetwork\n  ): LitecoinTransaction<TNumber> {\n    if (!network) {\n      throw new Error(`must provide network`);\n    }\n\n    const bufferReader = new BufferReader(buffer);\n    const txVersion = bufferReader.readInt32();\n    const marker = bufferReader.readUInt8();\n    const flag = bufferReader.readUInt8();\n\n    if (\n      marker === LitecoinTransaction.ADVANCED_TRANSACTION_MARKER &&\n      flag === LitecoinTransaction.MWEB_PEGOUT_TX_FLAG\n    ) {\n      // Litecoin has an MWEB advanced transaction marker. Slice out the marker and 5th to last byte  and read like a normal transaction\n      const bufferWriter = new BufferWriter(Buffer.allocUnsafe(buffer.length - 3));\n      bufferWriter.writeUInt32(txVersion);\n      bufferWriter.writeSlice(buffer.slice(6, buffer.length - 5));\n      bufferWriter.writeSlice(buffer.slice(buffer.length - 4, buffer.length));\n      return super.fromBuffer(bufferWriter.buffer, noStrict, amountType, network);\n    }\n    return super.fromBuffer(buffer, noStrict, amountType, network);\n  }\n}\n"]}