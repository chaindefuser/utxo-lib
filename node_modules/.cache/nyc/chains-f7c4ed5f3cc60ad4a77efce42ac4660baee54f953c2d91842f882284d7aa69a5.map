{"version":3,"file":"/Users/qroc/Code/hapi/chaindefuser/utxo-lib/src/bitgo/wallet/chains.ts","sources":["/Users/qroc/Code/hapi/chaindefuser/utxo-lib/src/bitgo/wallet/chains.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * Defines BitGo mappings between bip32 derivation path and script type.\n *\n * The scripts for a BitGo wallet address are defined by their derivation path.\n *\n * The derivation path has the format `0/0/${chain}/${index}` (in rare cases the prefix is not 0/0)\n *\n * The address script type (ScriptType2Of3) is defined by the `chain` parameter.\n *\n * This file defines the mapping between chain parameter and address type.\n */\nimport { ScriptType2Of3 } from '../outputScripts';\n\n/**\n * All valid chain codes\n */\nexport const chainCodesP2sh = [0, 1] as const;\nexport const chainCodesP2shP2wsh = [10, 11] as const;\nexport const chainCodesP2wsh = [20, 21] as const;\nexport const chainCodesP2tr = [30, 31] as const;\nexport const chainCodesP2trMusig2 = [40, 41] as const;\nexport const chainCodes = [\n  ...chainCodesP2sh,\n  ...chainCodesP2shP2wsh,\n  ...chainCodesP2wsh,\n  ...chainCodesP2tr,\n  ...chainCodesP2trMusig2,\n];\nexport type ChainCode = (typeof chainCodes)[number];\nexport function isChainCode(n: unknown): n is ChainCode {\n  return chainCodes.includes(n as ChainCode);\n}\n\n/**\n * A script type maps to two ChainCodes:\n * External addresses are intended for deposits, internal addresses are intended for change outputs.\n */\nexport type ChainCodePair = Readonly<[external: ChainCode, internal: ChainCode]>;\n\nconst map = new Map<ScriptType2Of3, ChainCodePair>(\n  [\n    ['p2sh', chainCodesP2sh],\n    ['p2shP2wsh', chainCodesP2shP2wsh],\n    ['p2wsh', chainCodesP2wsh],\n    ['p2tr', chainCodesP2tr],\n    ['p2trMusig2', chainCodesP2trMusig2],\n  ].map(([k, v]) => [k as ScriptType2Of3, Object.freeze(v) as ChainCodePair])\n);\n// @ts-ignore\nconst pairs = [...map.values()];\n\n/**\n * @return ChainCodePair for input\n */\nexport function toChainPair(v: ChainCodePair | ChainCode | ScriptType2Of3): ChainCodePair {\n  let pair;\n  if (Array.isArray(v)) {\n    if (pairs.includes(v as ChainCodePair)) {\n      pair = v;\n    }\n  }\n  if (typeof v === 'string') {\n    pair = map.get(v);\n  }\n  if (typeof v === 'number') {\n    pair = pairs.find((p) => p.includes(v));\n  }\n  if (!pair) {\n    throw new Error(`no pair for input ${v}`);\n  }\n  return pair as ChainCodePair;\n}\n\n/**\n * @return ScriptType2Of3 for input\n */\nexport function scriptTypeForChain(chain: ChainCode): ScriptType2Of3 {\n  // @ts-ignore\n  for (const [scriptType, pair] of map.entries()) {\n    if (pair.includes(chain)) {\n      return scriptType;\n    }\n  }\n  throw new Error(`invalid chain ${chain}`);\n}\n\n/**\n * @return chain code intended for external addresses\n */\nexport function getExternalChainCode(v: ChainCodePair | ScriptType2Of3 | ChainCode): ChainCode {\n  return toChainPair(v)[0];\n}\n\n/**\n * @return chain code intended for change outputs\n */\nexport function getInternalChainCode(v: ChainCodePair | ScriptType2Of3 | ChainCode): ChainCode {\n  return toChainPair(v)[1];\n}\n\n/**\n * @return true iff chain code is external\n */\nexport function isExternalChainCode(v: ChainCode): boolean {\n  return toChainPair(v).indexOf(v) === 0;\n}\n\n/**\n * @return true iff chain code is internal\n */\nexport function isInternalChainCode(v: ChainCode): boolean {\n  return toChainPair(v).indexOf(v) === 1;\n}\n\n/**\n * @return true iff chain code is a segwit address\n */\nexport function isSegwit(v: ChainCode): boolean {\n  const segwitCodes: ChainCode[] = [\n    ...chainCodesP2shP2wsh,\n    ...chainCodesP2wsh,\n    ...chainCodesP2tr,\n    ...chainCodesP2trMusig2,\n  ];\n  return segwitCodes.includes(v);\n}\n"]}