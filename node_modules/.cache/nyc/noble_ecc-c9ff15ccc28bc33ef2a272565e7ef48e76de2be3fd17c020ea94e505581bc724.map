{"version":3,"file":"/Users/qroc/Code/hapi/chaindefuser/utxo-lib/src/noble_ecc.ts","sources":["/Users/qroc/Code/hapi/chaindefuser/utxo-lib/src/noble_ecc.ts"],"names":[],"mappings":";;;AAAA,0CAA0C;AAC1C,0CAA0C;AAC1C,mCAAmE;AACnE,yCAAyC;AACzC,iCAA+D;AAC/D,6DAA6D;AAC7D,sHAAsH;AACtH,8DAA8D;AAC9D,+CAA0D;AAE1D,IAAI,CAAC,KAAK,CAAC,UAAU,GAAG,CAAC,GAAG,QAAsB,EAAc,EAAE;IAChE,MAAM,MAAM,GAAG,UAAU,CAAC,QAAQ,CAAC,CAAC;IACpC,KAAK,MAAM,OAAO,IAAI,QAAQ;QAAE,MAAM,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC;IACvD,OAAO,MAAM,CAAC,MAAM,EAAE,CAAC;AACzB,CAAC,CAAC;AAEF,IAAI,CAAC,KAAK,CAAC,cAAc,GAAG,CAAC,GAAe,EAAE,GAAG,QAAsB,EAAc,EAAE;IACrF,MAAM,IAAI,GAAG,UAAU,CAAC,QAAQ,EAAE,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC;IACpD,QAAQ,CAAC,OAAO,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC;IACxC,OAAO,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE,CAAC,CAAC;AACxC,CAAC,CAAC;AAEF,MAAM,WAAW,GAAG,CAAC,KAAe,EAAW,EAAE,CAAC,KAAK,KAAK,KAAK,CAAC;AAElE,SAAS,WAAW,CAAO,EAAc;IACvC,IAAI,CAAC;QACH,OAAO,EAAE,EAAE,CAAC;IACd,CAAC;IAAC,OAAO,CAAC,EAAE,CAAC;QACX,OAAO,IAAI,CAAC;IACd,CAAC;AACH,CAAC;AAED,SAAS,OAAO,CAAC,CAAa,EAAE,KAAc;IAC5C,IAAI,CAAC,CAAC,CAAC,MAAM,KAAK,EAAE,CAAC,KAAK,KAAK;QAAE,OAAO,KAAK,CAAC;IAC9C,IAAI,CAAC;QACH,OAAO,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC;IACjC,CAAC;IAAC,OAAO,CAAC,EAAE,CAAC;QACX,OAAO,KAAK,CAAC;IACf,CAAC;AACH,CAAC;AAED,SAAS,QAAQ,CAAC,CAAsB;IACtC,MAAM,IAAI,GAAG,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;IAC5B,IAAI,IAAI,CAAC,MAAM,KAAK,EAAE,EAAE,CAAC;QACvB,MAAM,IAAI,KAAK,CAAC,6BAA6B,CAAC,CAAC;IACjD,CAAC;IACD,OAAO,MAAM,CAAC,KAAK,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,EAAE,CAAC,CAAC;AAC7C,CAAC;AAED,MAAM,GAAG,GAAG;IACV,OAAO,EAAE,CAAC,CAAa,EAAW,EAAE,CAAC,OAAO,CAAC,CAAC,EAAE,KAAK,CAAC;IACtD,SAAS,EAAE,CAAC,CAAa,EAAW,EAAE,CAAC,IAAI,CAAC,KAAK,CAAC,iBAAiB,CAAC,CAAC,CAAC;IACtE,YAAY,EAAE,CAAC,CAAa,EAAW,EAAE,CAAC,OAAO,CAAC,CAAC,EAAE,IAAI,CAAC;IAE1D,kBAAkB,EAAE,CAAC,CAAa,EAAE,KAAiB,EAAqD,EAAE,CAC1G,WAAW,CAAC,GAAG,EAAE;QACf,MAAM,CAAC,GAAG,IAAI,CAAC,KAAK,CAAC,cAAc,CAAC,CAAC,EAAE,KAAK,EAAE,IAAI,CAAC,CAAC;QACpD,MAAM,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;QACtC,OAAO,EAAE,MAAM,EAAE,WAAW,EAAE,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE,CAAC;IAC7C,CAAC,CAAC;IAEJ,eAAe,EAAE,CAAC,EAAc,EAAE,UAAoB,EAAqB,EAAE,CAC3E,WAAW,CAAC,GAAG,EAAE,CAAC,IAAI,CAAC,YAAY,CAAC,EAAE,EAAE,WAAW,CAAC,UAAU,CAAC,CAAC,CAAC;IAEnE,aAAa,EAAE,CAAC,CAAa,EAAE,UAAoB,EAAc,EAAE;QACjE,OAAO,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,UAAU,CAAC,WAAW,CAAC,UAAU,CAAC,CAAC,CAAC;IACnE,CAAC;IAED,aAAa,EAAE,CAAC,CAAa,EAAE,KAAiB,EAAE,UAAoB,EAAqB,EAAE,CAC3F,WAAW,CAAC,GAAG,EAAE,CAAC,IAAI,CAAC,KAAK,CAAC,aAAa,CAAC,CAAC,EAAE,KAAK,EAAE,WAAW,CAAC,UAAU,CAAC,CAAC,CAAC;IAEhF,QAAQ,EAAE,CAAC,CAAa,EAAE,CAAa,EAAE,UAAoB,EAAqB,EAAE,CAClF,WAAW,CAAC,GAAG,EAAE;QACf,MAAM,CAAC,GAAG,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC;QAChC,MAAM,CAAC,GAAG,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC;QAChC,OAAO,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,UAAU,CAAC,WAAW,CAAC,UAAU,CAAC,CAAC,CAAC;IACtD,CAAC,CAAC;IAEJ,cAAc,EAAE,CAAC,CAAa,EAAE,KAAiB,EAAE,UAAoB,EAAqB,EAAE,CAC5F,WAAW,CAAC,GAAG,EAAE,CAAC,IAAI,CAAC,KAAK,CAAC,cAAc,CAAC,CAAC,EAAE,KAAK,EAAE,WAAW,CAAC,UAAU,CAAC,CAAC,CAAC;IAEjF,UAAU,EAAE,CAAC,CAAa,EAAE,KAAiB,EAAqB,EAAE,CAClE,WAAW,CAAC,GAAG,EAAE;QACf,MAAM,GAAG,GAAG,IAAI,CAAC,KAAK,CAAC,UAAU,CAAC,CAAC,EAAE,KAAK,CAAC,CAAC;QAC5C,kFAAkF;QAClF,2CAA2C;QAC3C,IAAI,GAAG,EAAE,KAAK,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,KAAK,CAAC,CAAC;YAAE,OAAO,IAAI,CAAC;QAC5C,OAAO,GAAG,CAAC;IACb,CAAC,CAAC;IAEJ,aAAa,EAAE,CAAC,CAAa,EAAc,EAAE,CAAC,IAAI,CAAC,KAAK,CAAC,aAAa,CAAC,CAAC,CAAC;IAEzE,IAAI,EAAE,CAAC,CAAa,EAAE,CAAa,EAAE,CAAc,EAAc,EAAE;QACjE,OAAO,IAAI,CAAC,QAAQ,CAAC,CAAC,EAAE,CAAC,EAAE,EAAE,GAAG,EAAE,KAAK,EAAE,YAAY,EAAE,CAAC,EAAE,CAAC,CAAC;IAC9D,CAAC;IAED,WAAW,EAAE,CAAC,CAAa,EAAE,CAAa,EAAE,IAAgB,MAAM,CAAC,KAAK,CAAC,EAAE,EAAE,IAAI,CAAC,EAAc,EAAE;QAChG,OAAO,IAAI,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;IACxC,CAAC;IAED,MAAM,EAAE,CAAC,CAAa,EAAE,CAAa,EAAE,SAAqB,EAAE,MAAgB,EAAW,EAAE;QACzF,OAAO,IAAI,CAAC,MAAM,CAAC,SAAS,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE,MAAM,EAAE,CAAC,CAAC;IAClD,CAAC;IAED,aAAa,EAAE,CAAC,CAAa,EAAE,CAAa,EAAE,SAAqB,EAAW,EAAE;QAC9E,OAAO,IAAI,CAAC,OAAO,CAAC,UAAU,CAAC,SAAS,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;IAClD,CAAC;CACF,CAAC;AAsEO,kBAAG;AApEZ,MAAM,MAAM,GAAG;IACb,GAAG,UAAU;IACb,mBAAmB,CAAC,CAAa,EAAE,CAAa,EAAE,QAAiB;QACjE,IAAI,CAAC;YACH,MAAM,OAAO,GAAG,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,oBAAoB,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,EAAE,QAAQ,CAAC,CAAC,CAAC,EAAE,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC;YACpG,IAAI,CAAC,OAAO;gBAAE,OAAO,IAAI,CAAC;YAC1B,OAAO,OAAO,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC;QACtC,CAAC;QAAC,MAAM,CAAC;YACP,OAAO,IAAI,CAAC;QACd,CAAC;IACH,CAAC;IACD,yBAAyB,CAAC,EAAc,EAAE,CAAa,EAAE,EAAc,EAAE,QAAiB;QACxF,IAAI,CAAC;YACH,MAAM,GAAG,GAAG,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,EAAE,CAAC,CAAC;YACnC,MAAM,CAAC,GAAG,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,EAAE,CAAC,CAAC,oBAAoB,CAAC,GAAG,EAAE,QAAQ,CAAC,CAAC,CAAC,EAAE,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC;YACnF,IAAI,CAAC,CAAC;gBAAE,OAAO,IAAI,CAAC;YACpB,OAAO,CAAC,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC;QAChC,CAAC;QAAC,MAAM,CAAC;YACP,OAAO,IAAI,CAAC;QACd,CAAC;IACH,CAAC;IACD,QAAQ,CAAC,CAAa,EAAE,CAAa,EAAE,QAAiB;QACtD,IAAI,CAAC;YACH,OAAO,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC;QAC/E,CAAC;QAAC,MAAM,CAAC;YACP,OAAO,IAAI,CAAC;QACd,CAAC;IACH,CAAC;IACD,aAAa,CAAC,CAAa,EAAE,KAAiB,EAAE,QAAiB;QAC/D,IAAI,CAAC;YACH,MAAM,CAAC,GAAG,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC;YAChC,MAAM,CAAC,GAAG,UAAU,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC;YACvC,MAAM,CAAC,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,oBAAoB,CAAC,CAAC,EAAE,CAAC,EAAE,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC;YAChE,IAAI,CAAC,CAAC;gBAAE,MAAM,IAAI,KAAK,CAAC,2BAA2B,CAAC,CAAC;YACrD,OAAO,CAAC,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC;QAChC,CAAC;QAAC,MAAM,CAAC;YACP,OAAO,IAAI,CAAC;QACd,CAAC;IACH,CAAC;IACD,aAAa,CAAC,CAAa,EAAE,QAAQ,GAAG,IAAI;QAC1C,OAAO,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC;IACpD,CAAC;IACD,KAAK,CAAC,CAAa;QACjB,IAAI,CAAC;YACH,OAAO,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC;QACjD,CAAC;QAAC,MAAM,CAAC;YACP,OAAO,IAAI,CAAC;QACd,CAAC;IACH,CAAC;IACD,YAAY,CAAC,CAAa,EAAE,QAAiB;QAC3C,IAAI,CAAC;YACH,OAAO,IAAI,CAAC,YAAY,CAAC,CAAC,EAAE,QAAQ,CAAC,CAAC;QACxC,CAAC;QAAC,MAAM,CAAC;YACP,OAAO,IAAI,CAAC;QACd,CAAC;IACH,CAAC;IACD,UAAU,EAAE,IAAI,CAAC,KAAK,CAAC,cAAc;IACrC,MAAM,CAAC,GAAG,QAAsB;QAC9B,MAAM,MAAM,GAAG,UAAU,CAAC,QAAQ,CAAC,CAAC;QACpC,KAAK,MAAM,OAAO,IAAI,QAAQ;YAAE,MAAM,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC;QACvD,OAAO,MAAM,CAAC,MAAM,EAAE,CAAC;IACzB,CAAC;CACF,CAAC;AAEF,MAAM,MAAM,GAAc,IAAA,sBAAa,EAAC,GAAG,CAAC,CAAC;AAI/B,wBAAM;AAHpB,MAAM,KAAK,GAAa,IAAA,oBAAY,EAAC,GAAG,CAAC,CAAC;AAGQ,sBAAK;AAFvD,MAAM,KAAK,GAAU,IAAA,oBAAY,EAAC,MAAM,CAAC,CAAC;AAEyC,sBAAK","sourcesContent":["import * as createHash from 'create-hash';\nimport * as createHmac from 'create-hmac';\nimport { ECPairAPI, ECPairFactory, ECPairInterface } from 'ecpair';\nimport * as necc from '@noble/secp256k1';\nimport { BIP32API, BIP32Factory, BIP32Interface } from 'bip32';\n// eslint-disable-next-line @typescript-eslint/ban-ts-comment\n// @ts-ignore base_crypto is exported as a subPath export, ignoring since compiler complains about importing like this\nimport * as baseCrypto from '@brandonblack/musig/base_crypto';\nimport { MuSig, MuSigFactory } from '@brandonblack/musig';\n\nnecc.utils.sha256Sync = (...messages: Uint8Array[]): Uint8Array => {\n  const sha256 = createHash('sha256');\n  for (const message of messages) sha256.update(message);\n  return sha256.digest();\n};\n\nnecc.utils.hmacSha256Sync = (key: Uint8Array, ...messages: Uint8Array[]): Uint8Array => {\n  const hash = createHmac('sha256', Buffer.from(key));\n  messages.forEach((m) => hash.update(m));\n  return Uint8Array.from(hash.digest());\n};\n\nconst defaultTrue = (param?: boolean): boolean => param !== false;\n\nfunction throwToNull<Type>(fn: () => Type): Type | null {\n  try {\n    return fn();\n  } catch (e) {\n    return null;\n  }\n}\n\nfunction isPoint(p: Uint8Array, xOnly: boolean): boolean {\n  if ((p.length === 32) !== xOnly) return false;\n  try {\n    return !!necc.Point.fromHex(p);\n  } catch (e) {\n    return false;\n  }\n}\n\nfunction toBigInt(b: Uint8Array | Buffer): bigint {\n  const buff = Buffer.from(b);\n  if (buff.length !== 32) {\n    throw new Error('Invalid size ${buff.length}');\n  }\n  return BigInt(`0x${buff.toString('hex')}`);\n}\n\nconst ecc = {\n  isPoint: (p: Uint8Array): boolean => isPoint(p, false),\n  isPrivate: (d: Uint8Array): boolean => necc.utils.isValidPrivateKey(d),\n  isXOnlyPoint: (p: Uint8Array): boolean => isPoint(p, true),\n\n  xOnlyPointAddTweak: (p: Uint8Array, tweak: Uint8Array): { parity: 0 | 1; xOnlyPubkey: Uint8Array } | null =>\n    throwToNull(() => {\n      const P = necc.utils.pointAddScalar(p, tweak, true);\n      const parity = P[0] % 2 === 1 ? 1 : 0;\n      return { parity, xOnlyPubkey: P.slice(1) };\n    }),\n\n  pointFromScalar: (sk: Uint8Array, compressed?: boolean): Uint8Array | null =>\n    throwToNull(() => necc.getPublicKey(sk, defaultTrue(compressed))),\n\n  pointCompress: (p: Uint8Array, compressed?: boolean): Uint8Array => {\n    return necc.Point.fromHex(p).toRawBytes(defaultTrue(compressed));\n  },\n\n  pointMultiply: (a: Uint8Array, tweak: Uint8Array, compressed?: boolean): Uint8Array | null =>\n    throwToNull(() => necc.utils.pointMultiply(a, tweak, defaultTrue(compressed))),\n\n  pointAdd: (a: Uint8Array, b: Uint8Array, compressed?: boolean): Uint8Array | null =>\n    throwToNull(() => {\n      const A = necc.Point.fromHex(a);\n      const B = necc.Point.fromHex(b);\n      return A.add(B).toRawBytes(defaultTrue(compressed));\n    }),\n\n  pointAddScalar: (p: Uint8Array, tweak: Uint8Array, compressed?: boolean): Uint8Array | null =>\n    throwToNull(() => necc.utils.pointAddScalar(p, tweak, defaultTrue(compressed))),\n\n  privateAdd: (d: Uint8Array, tweak: Uint8Array): Uint8Array | null =>\n    throwToNull(() => {\n      const res = necc.utils.privateAdd(d, tweak);\n      // tiny-secp256k1 returns null rather than allowing a 0 private key to be returned\n      // ECPair.testEcc() requires that behavior.\n      if (res?.every((i) => i === 0)) return null;\n      return res;\n    }),\n\n  privateNegate: (d: Uint8Array): Uint8Array => necc.utils.privateNegate(d),\n\n  sign: (h: Uint8Array, d: Uint8Array, e?: Uint8Array): Uint8Array => {\n    return necc.signSync(h, d, { der: false, extraEntropy: e });\n  },\n\n  signSchnorr: (h: Uint8Array, d: Uint8Array, e: Uint8Array = Buffer.alloc(32, 0x00)): Uint8Array => {\n    return necc.schnorr.signSync(h, d, e);\n  },\n\n  verify: (h: Uint8Array, Q: Uint8Array, signature: Uint8Array, strict?: boolean): boolean => {\n    return necc.verify(signature, h, Q, { strict });\n  },\n\n  verifySchnorr: (h: Uint8Array, Q: Uint8Array, signature: Uint8Array): boolean => {\n    return necc.schnorr.verifySync(signature, h, Q);\n  },\n};\n\nconst crypto = {\n  ...baseCrypto,\n  pointMultiplyUnsafe(p: Uint8Array, a: Uint8Array, compress: boolean): Uint8Array | null {\n    try {\n      const product = necc.Point.fromHex(p).multiplyAndAddUnsafe(necc.Point.ZERO, toBigInt(a), BigInt(1));\n      if (!product) return null;\n      return product.toRawBytes(compress);\n    } catch {\n      return null;\n    }\n  },\n  pointMultiplyAndAddUnsafe(p1: Uint8Array, a: Uint8Array, p2: Uint8Array, compress: boolean): Uint8Array | null {\n    try {\n      const p2p = necc.Point.fromHex(p2);\n      const p = necc.Point.fromHex(p1).multiplyAndAddUnsafe(p2p, toBigInt(a), BigInt(1));\n      if (!p) return null;\n      return p.toRawBytes(compress);\n    } catch {\n      return null;\n    }\n  },\n  pointAdd(a: Uint8Array, b: Uint8Array, compress: boolean): Uint8Array | null {\n    try {\n      return necc.Point.fromHex(a).add(necc.Point.fromHex(b)).toRawBytes(compress);\n    } catch {\n      return null;\n    }\n  },\n  pointAddTweak(p: Uint8Array, tweak: Uint8Array, compress: boolean): Uint8Array | null {\n    try {\n      const P = necc.Point.fromHex(p);\n      const t = baseCrypto.readSecret(tweak);\n      const Q = necc.Point.BASE.multiplyAndAddUnsafe(P, t, BigInt(1));\n      if (!Q) throw new Error('Tweaked point at infinity');\n      return Q.toRawBytes(compress);\n    } catch {\n      return null;\n    }\n  },\n  pointCompress(p: Uint8Array, compress = true): Uint8Array {\n    return necc.Point.fromHex(p).toRawBytes(compress);\n  },\n  liftX(p: Uint8Array): Uint8Array | null {\n    try {\n      return necc.Point.fromHex(p).toRawBytes(false);\n    } catch {\n      return null;\n    }\n  },\n  getPublicKey(s: Uint8Array, compress: boolean): Uint8Array | null {\n    try {\n      return necc.getPublicKey(s, compress);\n    } catch {\n      return null;\n    }\n  },\n  taggedHash: necc.utils.taggedHashSync,\n  sha256(...messages: Uint8Array[]): Uint8Array {\n    const sha256 = createHash('sha256');\n    for (const message of messages) sha256.update(message);\n    return sha256.digest();\n  },\n};\n\nconst ECPair: ECPairAPI = ECPairFactory(ecc);\nconst bip32: BIP32API = BIP32Factory(ecc);\nconst musig: MuSig = MuSigFactory(crypto);\n\nexport { ecc, ECPair, ECPairAPI, ECPairInterface, bip32, BIP32API, BIP32Interface, musig, MuSig };\n"]}