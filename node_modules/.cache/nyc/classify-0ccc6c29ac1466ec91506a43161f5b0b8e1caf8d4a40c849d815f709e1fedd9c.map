{"version":3,"file":"/Users/qroc/Code/hapi/chaindefuser/utxo-lib/src/classify.ts","sources":["/Users/qroc/Code/hapi/chaindefuser/utxo-lib/src/classify.ts"],"names":[],"mappings":";;;AAwE0B,8BAAK;AAAoB,gCAAM;AAAqB,kCAAO;AAxErF,yBAAuC;AACvC,iDAAiD;AACjD,iDAAiD;AACjD,6CAA6C;AAC7C,qDAAqD;AACrD,qDAAqD;AACrD,+CAA+C;AAC/C,uDAAuD;AACvD,mEAAmE;AACnE,mEAAmE;AACnE,mEAAmE;AAEnE,MAAM,KAAK,GAAG;IACZ,IAAI,EAAE,UAAoB;IAC1B,WAAW,EAAE,aAAuB;IACpC,QAAQ,EAAE,UAAoB;IAC9B,IAAI,EAAE,QAAkB;IACxB,KAAK,EAAE,YAAsB;IAC7B,IAAI,EAAE,YAAsB;IAC5B,MAAM,EAAE,mBAA6B;IACrC,KAAK,EAAE,mBAA6B;IACpC,IAAI,EAAE,SAAmB;IACzB,OAAO,EAAE,aAAuB;IAChC,kBAAkB,EAAE,mBAA6B;CAClD,CAAC;AAgDqF,sBAAK;AA9C5F,SAAS,cAAc,CAAC,MAAc;IACpC,IAAI,iBAAiB,CAAC,MAAM,CAAC,KAAK,CAAC,MAAM,CAAC;QAAE,OAAO,KAAK,CAAC,MAAM,CAAC;IAChE,IAAI,iBAAiB,CAAC,MAAM,CAAC,KAAK,CAAC,MAAM,CAAC;QAAE,OAAO,KAAK,CAAC,KAAK,CAAC;IAC/D,IAAI,OAAO,CAAC,MAAM,CAAC,KAAK,CAAC,MAAM,CAAC;QAAE,OAAO,KAAK,CAAC,IAAI,CAAC;IACpD,IAAI,UAAU,CAAC,MAAM,CAAC,KAAK,CAAC,MAAM,CAAC;QAAE,OAAO,KAAK,CAAC,KAAK,CAAC;IACxD,IAAI,UAAU,CAAC,MAAM,CAAC,KAAK,CAAC,MAAM,CAAC;QAAE,OAAO,KAAK,CAAC,IAAI,CAAC;IAEvD,kEAAkE;IAClE,MAAM,MAAM,GAAG,SAAO,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC;IACzC,IAAI,CAAC,MAAM;QAAE,MAAM,IAAI,SAAS,CAAC,gBAAgB,CAAC,CAAC;IAEnD,IAAI,WAAW,CAAC,MAAM,CAAC,KAAK,CAAC,MAAM,CAAC;QAAE,OAAO,KAAK,CAAC,OAAO,CAAC;IAC3D,IAAI,QAAQ,CAAC,MAAM,CAAC,KAAK,CAAC,MAAM,CAAC;QAAE,OAAO,KAAK,CAAC,IAAI,CAAC;IACrD,IAAI,MAAM,CAAC,MAAM,CAAC,KAAK,CAAC,MAAM,CAAC;QAAE,OAAO,KAAK,CAAC,IAAI,CAAC;IACnD,IAAI,iBAAiB,CAAC,MAAM,CAAC,KAAK,CAAC,MAAM,CAAC;QAAE,OAAO,KAAK,CAAC,kBAAkB,CAAC;IAC5E,IAAI,QAAQ,CAAC,MAAM,CAAC,KAAK,CAAC,MAAM,CAAC;QAAE,OAAO,KAAK,CAAC,QAAQ,CAAC;IAEzD,OAAO,KAAK,CAAC,WAAW,CAAC;AAC3B,CAAC;AAED,SAAS,aAAa,CAAC,MAAc,EAAE,eAAyB;IAC9D,kEAAkE;IAClE,MAAM,MAAM,GAAG,SAAO,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC;IACzC,IAAI,CAAC,MAAM;QAAE,MAAM,IAAI,SAAS,CAAC,gBAAgB,CAAC,CAAC;IAEnD,IAAI,UAAU,CAAC,KAAK,CAAC,KAAK,CAAC,MAAM,CAAC;QAAE,OAAO,KAAK,CAAC,KAAK,CAAC;IACvD,IAAI,UAAU,CAAC,KAAK,CAAC,KAAK,CAAC,MAAM,EAAE,eAAe,CAAC;QAAE,OAAO,KAAK,CAAC,IAAI,CAAC;IACvE,IAAI,WAAW,CAAC,KAAK,CAAC,KAAK,CAAC,MAAM,EAAE,eAAe,CAAC;QAAE,OAAO,KAAK,CAAC,OAAO,CAAC;IAC3E,IAAI,QAAQ,CAAC,KAAK,CAAC,KAAK,CAAC,MAAM,EAAE,eAAe,CAAC;QAAE,OAAO,KAAK,CAAC,IAAI,CAAC;IACrE,IAAI,MAAM,CAAC,KAAK,CAAC,KAAK,CAAC,MAAM,CAAC;QAAE,OAAO,KAAK,CAAC,IAAI,CAAC;IAElD,OAAO,KAAK,CAAC,WAAW,CAAC;AAC3B,CAAC;AAED,SAAS,eAAe,CAAC,MAAgB,EAAE,eAAyB;IAClE,kEAAkE;IAClE,MAAM,MAAM,GAAG,SAAO,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC;IACzC,IAAI,CAAC,MAAM;QAAE,MAAM,IAAI,SAAS,CAAC,gBAAgB,CAAC,CAAC;IAEnD,IAAI,iBAAiB,CAAC,KAAK,CAAC,KAAK,CAAC,MAAM,CAAC;QAAE,OAAO,KAAK,CAAC,MAAM,CAAC;IAC/D,IAAI,iBAAiB,CAAC,KAAK,CAAC,KAAK,CAAC,MAAkB,EAAE,eAAe,CAAC;QAAE,OAAO,KAAK,CAAC,KAAK,CAAC;IAC3F,IAAI,OAAO,CAAC,KAAK,CAAC,KAAK,CAAC,MAAkB,CAAC;QAAE,OAAO,KAAK,CAAC,IAAI,CAAC;IAE/D,OAAO,KAAK,CAAC,WAAW,CAAC;AAC3B,CAAC","sourcesContent":["import { script as bscript } from './';\nimport * as multisig from './templates/multisig';\nimport * as nullData from './templates/nulldata';\nimport * as pubKey from './templates/pubkey';\nimport * as pubKeyHash from './templates/pubkeyhash';\nimport * as scriptHash from './templates/scripthash';\nimport * as taproot from './templates/taproot';\nimport * as taprootnofn from './templates/taprootnofn';\nimport * as witnessCommitment from './templates/witnesscommitment';\nimport * as witnessPubKeyHash from './templates/witnesspubkeyhash';\nimport * as witnessScriptHash from './templates/witnessscripthash';\n\nconst types = {\n  P2MS: 'multisig' as string,\n  NONSTANDARD: 'nonstandard' as string,\n  NULLDATA: 'nulldata' as string,\n  P2PK: 'pubkey' as string,\n  P2PKH: 'pubkeyhash' as string,\n  P2SH: 'scripthash' as string,\n  P2WPKH: 'witnesspubkeyhash' as string,\n  P2WSH: 'witnessscripthash' as string,\n  P2TR: 'taproot' as string,\n  P2TR_NS: 'taprootnofn' as string,\n  WITNESS_COMMITMENT: 'witnesscommitment' as string,\n};\n\nfunction classifyOutput(script: Buffer): string {\n  if (witnessPubKeyHash.output.check(script)) return types.P2WPKH;\n  if (witnessScriptHash.output.check(script)) return types.P2WSH;\n  if (taproot.output.check(script)) return types.P2TR;\n  if (pubKeyHash.output.check(script)) return types.P2PKH;\n  if (scriptHash.output.check(script)) return types.P2SH;\n\n  // XXX: optimization, below functions bscript.decompile before use\n  const chunks = bscript.decompile(script);\n  if (!chunks) throw new TypeError('Invalid script');\n\n  if (taprootnofn.output.check(chunks)) return types.P2TR_NS;\n  if (multisig.output.check(chunks)) return types.P2MS;\n  if (pubKey.output.check(chunks)) return types.P2PK;\n  if (witnessCommitment.output.check(chunks)) return types.WITNESS_COMMITMENT;\n  if (nullData.output.check(chunks)) return types.NULLDATA;\n\n  return types.NONSTANDARD;\n}\n\nfunction classifyInput(script: Buffer, allowIncomplete?: boolean): string {\n  // XXX: optimization, below functions bscript.decompile before use\n  const chunks = bscript.decompile(script);\n  if (!chunks) throw new TypeError('Invalid script');\n\n  if (pubKeyHash.input.check(chunks)) return types.P2PKH;\n  if (scriptHash.input.check(chunks, allowIncomplete)) return types.P2SH;\n  if (taprootnofn.input.check(chunks, allowIncomplete)) return types.P2TR_NS;\n  if (multisig.input.check(chunks, allowIncomplete)) return types.P2MS;\n  if (pubKey.input.check(chunks)) return types.P2PK;\n\n  return types.NONSTANDARD;\n}\n\nfunction classifyWitness(script: Buffer[], allowIncomplete?: boolean): string {\n  // XXX: optimization, below functions bscript.decompile before use\n  const chunks = bscript.decompile(script);\n  if (!chunks) throw new TypeError('Invalid script');\n\n  if (witnessPubKeyHash.input.check(chunks)) return types.P2WPKH;\n  if (witnessScriptHash.input.check(chunks as Buffer[], allowIncomplete)) return types.P2WSH;\n  if (taproot.input.check(chunks as Buffer[])) return types.P2TR;\n\n  return types.NONSTANDARD;\n}\n\nexport { classifyInput as input, classifyOutput as output, classifyWitness as witness, types };\n"]}