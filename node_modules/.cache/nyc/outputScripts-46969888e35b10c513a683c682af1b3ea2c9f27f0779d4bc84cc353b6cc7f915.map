{"version":3,"file":"/Users/qroc/Code/hapi/chaindefuser/utxo-lib/src/bitgo/outputScripts.ts","sources":["/Users/qroc/Code/hapi/chaindefuser/utxo-lib/src/bitgo/outputScripts.ts"],"names":[],"mappings":"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","sourcesContent":["import * as assert from 'assert';\nimport * as bitcoinjs from 'bitcoinjs-lib';\n\nimport { Network, supportsSegwit, supportsTaproot } from '../networks';\nimport * as p2trPayments from '../payments';\nimport * as taproot from '../taproot';\n\nimport { isTriple, Triple, Tuple } from './types';\n\nimport { ecc as eccLib } from '../noble_ecc';\nimport { getDepthFirstTaptree, getTweakedOutputKey } from '../taproot';\n\nexport { scriptTypeForChain } from './wallet/chains';\n\nexport const scriptTypeP2shP2pk = 'p2shP2pk';\nexport type ScriptTypeP2shP2pk = typeof scriptTypeP2shP2pk;\n\nexport const scriptTypes2Of3 = ['p2sh', 'p2shP2wsh', 'p2wsh', 'p2tr', 'p2trMusig2'] as const;\nexport type ScriptType2Of3 = (typeof scriptTypes2Of3)[number];\n\nexport function isScriptType2Of3(t: string): t is ScriptType2Of3 {\n  return scriptTypes2Of3.includes(t as ScriptType2Of3);\n}\n\nexport type ScriptType = ScriptTypeP2shP2pk | ScriptType2Of3;\n\n/**\n * @return true iff scriptType requires witness data\n */\nexport function hasWitnessData(scriptType: ScriptType): scriptType is 'p2shP2wsh' | 'p2wsh' | 'p2tr' | 'p2trMusig2' {\n  return ['p2shP2wsh', 'p2wsh', 'p2tr', 'p2trMusig2'].includes(scriptType);\n}\n\n/**\n * @param network\n * @param scriptType\n * @return true iff script type is supported for network\n */\nexport function isSupportedScriptType(network: Network, scriptType: ScriptType): boolean {\n  switch (scriptType) {\n    case 'p2sh':\n    case 'p2shP2pk':\n      return true;\n    case 'p2shP2wsh':\n    case 'p2wsh':\n      return supportsSegwit(network);\n    case 'p2tr':\n    case 'p2trMusig2':\n      return supportsTaproot(network);\n  }\n\n  /* istanbul ignore next */\n  throw new Error(`unexpected script type ${scriptType}`);\n}\n\n/**\n * @param t\n * @return string prevOut as defined in PREVOUT_TYPES (bitcoinjs-lib/.../transaction_builder.js)\n */\nexport function scriptType2Of3AsPrevOutType(t: ScriptType2Of3): string {\n  switch (t) {\n    case 'p2sh':\n      return 'p2sh-p2ms';\n    case 'p2shP2wsh':\n      return 'p2sh-p2wsh-p2ms';\n    case 'p2wsh':\n      return 'p2wsh-p2ms';\n    case 'p2tr':\n      return 'p2tr-p2ns';\n    case 'p2trMusig2':\n      return 'p2tr';\n  }\n\n  /* istanbul ignore next */\n  throw new Error(`unsupported script type ${t}`);\n}\n\nexport type SpendableScript = {\n  scriptPubKey: Buffer;\n  redeemScript?: Buffer;\n  witnessScript?: Buffer;\n};\n\nexport type SpendScriptP2tr = {\n  controlBlock: Buffer;\n  witnessScript: Buffer;\n  leafVersion: number;\n  leafHash: Buffer;\n};\n\n/**\n * Tweak data holder for P2tr Musig2 key path.\n */\nexport type KeyPathP2trMusig2 = {\n  internalPubkey: Buffer;\n  outputPubkey: Buffer;\n  taptreeRoot: Buffer;\n};\n\n/**\n * Return scripts for p2sh-p2pk (used for BCH/BSV replay protection)\n * @param pubkey\n */\nexport function createOutputScriptP2shP2pk(pubkey: Buffer): SpendableScript {\n  const p2pk = bitcoinjs.payments.p2pk({ pubkey });\n  const p2sh = bitcoinjs.payments.p2sh({ redeem: p2pk });\n  if (!p2sh.output || !p2pk.output) {\n    throw new Error(`invalid state`);\n  }\n  return {\n    scriptPubKey: p2sh.output,\n    redeemScript: p2pk.output,\n  };\n}\n\nexport function getOutputScript(scriptType: 'p2sh' | 'p2shP2wsh' | 'p2wsh', conditionScript: Buffer): Buffer {\n  let output;\n  switch (scriptType) {\n    case 'p2sh':\n      ({ output } = bitcoinjs.payments.p2sh({ redeem: { output: conditionScript } }));\n      break;\n    case 'p2shP2wsh':\n      ({ output } = bitcoinjs.payments.p2sh({\n        redeem: { output: getOutputScript('p2wsh', conditionScript) },\n      }));\n      break;\n    case 'p2wsh':\n      ({ output } = bitcoinjs.payments.p2wsh({ redeem: { output: conditionScript } }));\n      break;\n  }\n  if (output === undefined) {\n    throw new Error(`output undefined`);\n  }\n  return output;\n}\n\n/**\n * Return scripts for 2-of-3 multisig output\n * @param pubkeys - the key triple for multisig\n * @param scriptType\n * @param network - if set, performs sanity check for scriptType support\n * @returns {{redeemScript, witnessScript, scriptPubKey}}\n */\nexport function createOutputScript2of3(\n  pubkeys: Buffer[],\n  scriptType: ScriptType2Of3,\n  network?: Network\n): SpendableScript {\n  if (network) {\n    if (!isSupportedScriptType(network, scriptType)) {\n      throw new Error(`unsupported script type ${scriptType} for network`);\n    }\n  }\n\n  if (!isTriple(pubkeys)) {\n    throw new Error(`must provide pubkey triple`);\n  }\n\n  pubkeys.forEach((key) => {\n    if (key.length !== 33) {\n      throw new Error(`Unexpected key length ${key.length}. Must use compressed keys.`);\n    }\n  });\n\n  if (scriptType === 'p2tr' || scriptType === 'p2trMusig2') {\n    // p2tr/p2trMusig2 addresses use a combination of 2 of 2 multisig scripts distinct from\n    // the 2 of 3 multisig used for other script types\n    return createTaprootScript2of3(scriptType, pubkeys);\n  }\n\n  const script2of3 = bitcoinjs.payments.p2ms({ m: 2, pubkeys });\n  assert(script2of3.output);\n\n  let redeemScript: bitcoinjs.Payment | undefined;\n  let witnessScript: bitcoinjs.Payment | undefined;\n  switch (scriptType) {\n    case 'p2sh':\n      redeemScript = script2of3;\n      break;\n    case 'p2shP2wsh':\n      witnessScript = script2of3;\n      redeemScript = bitcoinjs.payments.p2wsh({ redeem: script2of3 });\n      break;\n    case 'p2wsh':\n      witnessScript = script2of3;\n      break;\n    default:\n      throw new Error(`unknown multisig script type ${scriptType}`);\n  }\n\n  return {\n    scriptPubKey: getOutputScript(scriptType, script2of3.output),\n    redeemScript: redeemScript?.output,\n    witnessScript: witnessScript?.output,\n  };\n}\n\nexport function toXOnlyPublicKey(b: Buffer): Buffer {\n  if (b.length === 33) {\n    return b.slice(1);\n  }\n  if (b.length === 32) {\n    return b;\n  }\n  throw new Error(`invalid key size ${b.length}`);\n}\n\nfunction checkSize(b: Buffer, targetSize: number, name: string): Buffer {\n  if (b.length === targetSize) {\n    return b;\n  }\n  throw new Error(`invalid size ${b.length}. Must use ${name}.`);\n}\n\n/**\n * Validates size of the pub key for 32 bytes and returns the same iff true.\n */\nexport function checkXOnlyPublicKey(b: Buffer): Buffer {\n  return checkSize(b, 32, 'x-only key');\n}\n\n/**\n * Validates size of the pub key for 32 bytes and returns the same iff true.\n */\nexport function checkPlainPublicKey(b: Buffer): Buffer {\n  return checkSize(b, 33, 'plain key');\n}\n\nexport function checkTapMerkleRoot(b: Buffer): Buffer {\n  return checkSize(b, 32, 'tap merkle root');\n}\n\nexport function checkTxHash(b: Buffer): Buffer {\n  return checkSize(b, 32, 'tx hash');\n}\n\nfunction getTaptreeKeyCombinations(scriptType: 'p2tr' | 'p2trMusig2', keys: Triple<Buffer>): Tuple<Buffer>[] {\n  const [userKey, backupKey, bitGoKey] = keys.map((k) => toXOnlyPublicKey(k));\n  return scriptType === 'p2tr'\n    ? [\n        [userKey, bitGoKey],\n        [userKey, backupKey],\n        [backupKey, bitGoKey],\n      ]\n    : [\n        [userKey, backupKey],\n        [backupKey, bitGoKey],\n      ];\n}\n\nfunction getKeyPathCombination(scriptType: 'p2tr' | 'p2trMusig2', keys: Triple<Buffer>): Tuple<Buffer> {\n  const sanitizePublicKey = scriptType === 'p2tr' ? toXOnlyPublicKey : checkPlainPublicKey;\n  return [sanitizePublicKey(keys[0]), sanitizePublicKey(keys[2])];\n}\n\nfunction getRedeemIndex(keyCombinations: [Buffer, Buffer][], signer: Buffer, cosigner: Buffer): number {\n  signer = toXOnlyPublicKey(signer);\n  cosigner = toXOnlyPublicKey(cosigner);\n  const i = keyCombinations.findIndex(([a, b]) => {\n    if (a.length !== signer.length || b.length !== cosigner.length) {\n      throw new Error(`invalid comparison`);\n    }\n    return (a.equals(signer) && b.equals(cosigner)) || (a.equals(cosigner) && b.equals(signer));\n  });\n  if (0 <= i) {\n    return i;\n  }\n  throw new Error(`could not find singer/cosigner combination`);\n}\n\nfunction createPaymentP2trCommon(\n  scriptType: 'p2tr' | 'p2trMusig2',\n  pubkeys: Triple<Buffer>,\n  redeemIndex?: number | { signer: Buffer; cosigner: Buffer }\n): bitcoinjs.Payment {\n  const keyCombinations2of2 = getTaptreeKeyCombinations(scriptType, pubkeys);\n  if (typeof redeemIndex === 'object') {\n    redeemIndex = getRedeemIndex(keyCombinations2of2, redeemIndex.signer, redeemIndex.cosigner);\n  }\n  const redeems = keyCombinations2of2.map((pubkeys, index) =>\n    p2trPayments.p2tr_ns(\n      {\n        pubkeys,\n        depth: scriptType === 'p2trMusig2' || index === 0 ? 1 : 2,\n      },\n      { eccLib }\n    )\n  );\n\n  return p2trPayments.p2tr(\n    {\n      pubkeys: getKeyPathCombination(scriptType, pubkeys),\n      redeems,\n      redeemIndex,\n    },\n    { eccLib }\n  );\n}\n\nexport function createPaymentP2tr(\n  pubkeys: Triple<Buffer>,\n  redeemIndex?: number | { signer: Buffer; cosigner: Buffer }\n): bitcoinjs.Payment {\n  return createPaymentP2trCommon('p2tr', pubkeys, redeemIndex);\n}\n\nexport function createPaymentP2trMusig2(\n  pubkeys: Triple<Buffer>,\n  redeemIndex?: number | { signer: Buffer; cosigner: Buffer }\n): bitcoinjs.Payment {\n  return createPaymentP2trCommon('p2trMusig2', pubkeys, redeemIndex);\n}\n\nfunction getLeafHashCommon(\n  scriptType: 'p2tr' | 'p2trMusig2',\n  params: bitcoinjs.Payment | { publicKeys: Triple<Buffer>; signer: Buffer; cosigner: Buffer }\n): Buffer {\n  if ('publicKeys' in params) {\n    params = createPaymentP2trCommon(scriptType, params.publicKeys, params);\n  }\n  const { output, controlBlock, redeem } = params;\n  if (!output || !controlBlock || !redeem || !redeem.output) {\n    throw new Error(`invalid state`);\n  }\n  return taproot.getTapleafHash(eccLib, controlBlock, redeem.output);\n}\n\nexport function getLeafHash(\n  params: bitcoinjs.Payment | { publicKeys: Triple<Buffer>; signer: Buffer; cosigner: Buffer }\n): Buffer {\n  return getLeafHashCommon('p2tr', params);\n}\n\nexport function createKeyPathP2trMusig2(pubkeys: Triple<Buffer>): KeyPathP2trMusig2 {\n  const payment = createPaymentP2trCommon('p2trMusig2', pubkeys);\n  assert(payment.internalPubkey);\n  assert(payment.tapTree);\n  return {\n    internalPubkey: payment.internalPubkey,\n    outputPubkey: getTweakedOutputKey(payment),\n    taptreeRoot: getDepthFirstTaptree(payment.tapTree).root,\n  };\n}\n\nfunction createSpendScriptP2trCommon(\n  scriptType: 'p2tr' | 'p2trMusig2',\n  pubkeys: Triple<Buffer>,\n  keyCombination: Tuple<Buffer>\n): SpendScriptP2tr {\n  const keyCombinations = getTaptreeKeyCombinations(scriptType, pubkeys);\n  const [a, b] = keyCombination.map((k) => toXOnlyPublicKey(k));\n  const redeemIndex = keyCombinations.findIndex(\n    ([c, d]) => (a.equals(c) && b.equals(d)) || (a.equals(d) && b.equals(c))\n  );\n\n  if (redeemIndex < 0) {\n    throw new Error(`could not find redeemIndex for key combination`);\n  }\n\n  const payment = createPaymentP2trCommon(scriptType, pubkeys, redeemIndex);\n  const { controlBlock } = payment;\n  assert(Buffer.isBuffer(controlBlock));\n\n  assert(payment.redeem);\n  const leafScript = payment.redeem.output;\n  assert(Buffer.isBuffer(leafScript));\n\n  const parsedControlBlock = taproot.parseControlBlock(eccLib, controlBlock);\n  const { leafVersion } = parsedControlBlock;\n  const leafHash = taproot.getTapleafHash(eccLib, parsedControlBlock, leafScript);\n\n  return {\n    controlBlock,\n    witnessScript: leafScript,\n    leafVersion,\n    leafHash,\n  };\n}\n\nexport function createSpendScriptP2tr(pubkeys: Triple<Buffer>, keyCombination: Tuple<Buffer>): SpendScriptP2tr {\n  return createSpendScriptP2trCommon('p2tr', pubkeys, keyCombination);\n}\n\nexport function createSpendScriptP2trMusig2(pubkeys: Triple<Buffer>, keyCombination: Tuple<Buffer>): SpendScriptP2tr {\n  return createSpendScriptP2trCommon('p2trMusig2', pubkeys, keyCombination);\n}\n\n/**\n * Creates and returns a taproot output script using the user+bitgo keys for the aggregate\n * public key using MuSig2 and a taptree containing either of the following depends on scriptType.\n * p2tr type: a user+bitgo 2-of-2 script at the first depth level of the tree and user+backup\n * and bitgo+backup 2-of-2 scripts one level deeper.\n * p2trMusig2 type: user+backup and bitgo+backup 2-of-2 scripts at the first depth level of the\n * tree.\n * @param pubkeys - a pubkey array containing the user key, backup key, and bitgo key in that order\n * @returns {{scriptPubKey}}\n */\nfunction createTaprootScript2of3(scriptType: 'p2tr' | 'p2trMusig2', pubkeys: Triple<Buffer>): SpendableScript {\n  const { output } = createPaymentP2trCommon(scriptType, pubkeys);\n  assert(Buffer.isBuffer(output));\n  return {\n    scriptPubKey: output,\n  };\n}\n"]}