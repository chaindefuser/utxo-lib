{"version":3,"file":"/Users/qroc/Code/hapi/chaindefuser/utxo-lib/src/bitgo/legacysafe/index.ts","sources":["/Users/qroc/Code/hapi/chaindefuser/utxo-lib/src/bitgo/legacysafe/index.ts"],"names":[],"mappings":";AAAA;;;;KAIK;;AAmBL,8CAEC;AAED,0CAEC;AAGD,4EAsCC;AAhED,iCAAiC;AACjC,+CAAgD;AAChD,6CAAoD;AACpD,oCAAoC;AACpC,2CAA2C;AAE3C,SAAS,kBAAkB,CAAC,SAAiB,EAAE,EAAE,UAAU,GAAG,IAAI,EAAE,GAAG,EAAE;IACvE,MAAM,GAAG,GAAG,eAAM,CAAC,aAAa,CAAC,SAAS,EAAE,UAAU,CAAC,CAAC;IACxD,IAAI,GAAG,KAAK,IAAI,EAAE,CAAC;QACjB,MAAM,IAAI,KAAK,CAAC,oBAAoB,CAAC,CAAC;IACxC,CAAC;IACD,MAAM,MAAM,GAAG,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;IAEhC,MAAM,CAAC,WAAW,CAAC,MAAM,CAAC,MAAM,EAAE,UAAU,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC;IACxD,OAAO,MAAM,CAAC;AAChB,CAAC;AAED,SAAgB,iBAAiB,CAAC,MAAc;IAC9C,OAAO,kBAAkB,CAAC,MAAM,EAAE,EAAE,UAAU,EAAE,KAAK,EAAE,CAAC,CAAC;AAC3D,CAAC;AAED,SAAgB,eAAe,CAAC,MAAc;IAC5C,OAAO,kBAAkB,CAAC,MAAM,EAAE,EAAE,UAAU,EAAE,IAAI,EAAE,CAAC,CAAC;AAC1D,CAAC;AAED,oDAAoD;AACpD,SAAgB,gCAAgC,CAC9C,OAAiB,EACjB,OAAiB;IAKjB,IAAI,OAAO,EAAE,CAAC;QACZ,IAAI,CAAC,IAAA,oBAAS,EAAC,OAAO,CAAC,EAAE,CAAC;YACxB,MAAM,IAAI,KAAK,CAAC,sDAAsD,OAAO,CAAC,IAAI,EAAE,CAAC,CAAC;QACxF,CAAC;IACH,CAAC;IAED,IAAI,CAAC,IAAA,gBAAQ,EAAC,OAAO,CAAC,EAAE,CAAC;QACvB,MAAM,IAAI,KAAK,CAAC,4BAA4B,CAAC,CAAC;IAChD,CAAC;IAED,OAAO,CAAC,OAAO,CAAC,CAAC,GAAG,EAAE,EAAE;QACtB,IAAI,GAAG,CAAC,MAAM,KAAK,OAAO,CAAC,CAAC,CAAC,CAAC,MAAM,EAAE,CAAC;YACrC,MAAM,IAAI,KAAK,CAAC,uCAAuC,CAAC,CAAC;QAC3D,CAAC;QACD,IAAI,GAAG,CAAC,MAAM,KAAK,EAAE,IAAI,GAAG,CAAC,MAAM,KAAK,EAAE,EAAE,CAAC;YAC3C,8EAA8E;YAC9E,MAAM,IAAI,KAAK,CAAC,yBAAyB,GAAG,CAAC,MAAM,wCAAwC,CAAC,CAAC;QAC/F,CAAC;IACH,CAAC,CAAC,CAAC;IAEH,MAAM,UAAU,GAAG,SAAS,CAAC,QAAQ,CAAC,IAAI,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,OAAO,EAAE,CAAC,CAAC;IAC9D,MAAM,CAAC,UAAU,CAAC,MAAM,CAAC,CAAC;IAE1B,MAAM,YAAY,GAAG,SAAS,CAAC,QAAQ,CAAC,IAAI,CAAC,EAAE,MAAM,EAAE,UAAU,EAAE,CAAC,CAAC;IACrE,MAAM,CAAC,YAAY,CAAC,CAAC;IACrB,MAAM,CAAC,YAAY,CAAC,MAAM,CAAC,CAAC;IAE5B,OAAO;QACL,YAAY,EAAE,YAAY,CAAC,MAAM;QACjC,YAAY,EAAE,UAAU,CAAC,MAAM;KAChC,CAAC;AACJ,CAAC","sourcesContent":["/**\n * V1 Safe Wallets are the oldest type of wallets that BitGo supports. They were\n * created back in 2013-14 and don't use HD chains. Instead, they have only one\n * P2SH address per wallet whose redeem script uses uncompressed public keys.\n * */\n\nimport * as assert from 'assert';\nimport { ecc as eccLib } from '../../noble_ecc';\nimport { isBitcoin, Network } from '../../networks';\nimport { isTriple } from '../types';\nimport * as bitcoinjs from 'bitcoinjs-lib';\n\nfunction getPublicKeyBuffer(publicKey: Buffer, { compressed = true } = {}): Buffer {\n  const res = eccLib.pointCompress(publicKey, compressed);\n  if (res === null) {\n    throw new Error('invalid public key');\n  }\n  const buffer = Buffer.from(res);\n\n  assert.strictEqual(buffer.length, compressed ? 33 : 65);\n  return buffer;\n}\n\nexport function toUncompressedPub(pubkey: Buffer): Buffer {\n  return getPublicKeyBuffer(pubkey, { compressed: false });\n}\n\nexport function toCompressedPub(pubkey: Buffer): Buffer {\n  return getPublicKeyBuffer(pubkey, { compressed: true });\n}\n\n/** create p2sh scripts with uncompressed pubkeys */\nexport function createLegacySafeOutputScript2of3(\n  pubkeys: Buffer[],\n  network?: Network\n): {\n  scriptPubKey: Buffer;\n  redeemScript: Buffer;\n} {\n  if (network) {\n    if (!isBitcoin(network)) {\n      throw new Error(`unsupported network for legacy safe output script: ${network.coin}`);\n    }\n  }\n\n  if (!isTriple(pubkeys)) {\n    throw new Error(`must provide pubkey triple`);\n  }\n\n  pubkeys.forEach((key) => {\n    if (key.length !== pubkeys[0].length) {\n      throw new Error(`all pubkeys must have the same length`);\n    }\n    if (key.length !== 65 && key.length !== 33) {\n      // V1 Safe BTC wallets could contain either uncompressed or compressed pubkeys\n      throw new Error(`Unexpected key length ${key.length}, neither compressed nor uncompressed.`);\n    }\n  });\n\n  const script2of3 = bitcoinjs.payments.p2ms({ m: 2, pubkeys });\n  assert(script2of3.output);\n\n  const scriptPubKey = bitcoinjs.payments.p2sh({ redeem: script2of3 });\n  assert(scriptPubKey);\n  assert(scriptPubKey.output);\n\n  return {\n    scriptPubKey: scriptPubKey.output,\n    redeemScript: script2of3.output,\n  };\n}\n"]}