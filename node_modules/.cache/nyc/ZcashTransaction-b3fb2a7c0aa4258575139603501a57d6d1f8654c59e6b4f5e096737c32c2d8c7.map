{"version":3,"file":"/Users/qroc/Code/hapi/chaindefuser/utxo-lib/src/bitgo/zcash/ZcashTransaction.ts","sources":["/Users/qroc/Code/hapi/chaindefuser/utxo-lib/src/bitgo/zcash/ZcashTransaction.ts"],"names":[],"mappings":";;;AAiCA,gFAWC;AAED,sFAuBC;AArED,iDAAoD;AACpD,iDAAiD;AACjD,+DAA2E;AAE3E,MAAM,OAAO,GAAG,OAAO,CAAC,iBAAiB,CAAC,CAAC;AAC3C,MAAM,SAAS,GAAG,OAAO,CAAC,WAAW,CAAC,CAAC;AAGvC,wDAAmE;AACnE,yDAA0G;AAC1G,+CAAkF;AAElF,MAAM,IAAI,GAAG,MAAM,CAAC,IAAI,CAAC,kEAAkE,EAAE,KAAK,CAAC,CAAC;AAIpG,8EAA8E;AAC9E,MAAM,wBAAwB,GAAG,UAAU,CAAC;AAC5C,8EAA8E;AAC9E,MAAM,uBAAuB,GAAG,UAAU,CAAC;AAE3C,4EAA4E;AAC5E,MAAM,oBAAoB,GAAG,UAAU,CAAC;AACxC,MAAM,gBAAgB,GAAG,UAAU,CAAC;AACpC,MAAM,aAAa,GAAG,UAAU,CAAC;AACjC,MAAM,aAAa,GAAG,UAAU,CAAC;AAEjC,MAAa,2BAA4B,SAAQ,KAAK;IACpD,YAAY,OAAe;QACzB,KAAK,CAAC,OAAO,CAAC,CAAC;IACjB,CAAC;CACF;AAJD,kEAIC;AAED,SAAgB,kCAAkC,CAAC,OAAe;IAChE,QAAQ,OAAO,EAAE,CAAC;QAChB,KAAK,GAAG,CAAC;QACT,KAAK,GAAG,CAAC;QACT,KAAK,GAAG;YACN,OAAO,wBAAwB,CAAC;QAClC,KAAK,GAAG,CAAC;QACT,KAAK,GAAG;YACN,OAAO,uBAAuB,CAAC;IACnC,CAAC;IACD,MAAM,IAAI,KAAK,CAAC,wBAAwB,OAAO,EAAE,CAAC,CAAC;AACrD,CAAC;AAED,SAAgB,qCAAqC,CAAC,OAAqB,EAAE,OAAe;IAC1F,QAAQ,OAAO,EAAE,CAAC;QAChB,KAAK,CAAC,CAAC;QACP,KAAK,CAAC;YACJ,OAAO,CAAC,CAAC;QACX,KAAK,CAAC;YACJ,OAAO,oBAAoB,CAAC;QAC9B,KAAK,gBAAgB,CAAC,sBAAsB;YAC1C,+BAA+B;YAC/B,OAAO,gBAAgB,CAAC;QAC1B,KAAK,gBAAgB,CAAC,mBAAmB,CAAC;QAC1C,KAAK,gBAAgB,CAAC,mBAAmB;YACvC,+BAA+B;YAC/B,gDAAgD;YAChD,OAAO,aAAa,CAAC;QACvB,KAAK,CAAC,CAAC;QACP,KAAK,CAAC,CAAC;QACP,KAAK,gBAAgB,CAAC,mBAAmB,CAAC;QAC1C,KAAK,gBAAgB,CAAC,mBAAmB;YACvC,+BAA+B;YAC/B,OAAO,aAAa,CAAC;IACzB,CAAC;IACD,MAAM,IAAI,KAAK,CAAC,wBAAwB,OAAO,EAAE,CAAC,CAAC;AACrD,CAAC;AAED,MAAa,gBAA2D,SAAQ,iCAAwB;IAmBtG,YAAmB,OAAqB,EAAE,EAAsC,EAAE,UAAgC;QAChH,KAAK,CAAC,OAAO,EAAE,EAAE,EAAE,UAAU,CAAC,CAAC;QADd,YAAO,GAAP,OAAO,CAAc;QARxC,+DAA+D;QAC/D,iBAAY,GAAG,CAAC,CAAC;QACjB,+EAA+E;QAC/E,mBAAc,GAAG,CAAC,CAAC;QACnB,iFAAiF;QACjF,iBAAY,GAAG,CAAC,CAAC;QAMf,IAAI,iBAAiB,CAAC;QACtB,IAAI,EAAE,EAAE,CAAC;YACP,IAAI,CAAC,YAAY,GAAG,EAAE,CAAC,YAAY,CAAC;YACpC,IAAI,CAAC,cAAc,GAAG,EAAE,CAAC,cAAc,CAAC;YACxC,IAAI,CAAC,YAAY,GAAG,EAAE,CAAC,YAAY,CAAC;YAEpC,IAAI,EAAE,CAAC,iBAAiB,KAAK,SAAS,EAAE,CAAC;gBACvC,iBAAiB,GAAG,EAAE,CAAC,iBAAiB,CAAC;YAC3C,CAAC;QACH,CAAC;QACD,IAAI,CAAC,iBAAiB,GAAG,iBAAiB,IAAI,qCAAqC,CAAC,OAAO,EAAE,IAAI,CAAC,OAAO,CAAC,CAAC;IAC7G,CAAC;IAED,MAAM,CAAC,UAAU,CACf,MAAc,EACd,UAAmB,EACnB,aAAkC,QAAQ,EAC1C,OAAsB;QAEtB,0BAA0B;QAC1B,IAAI,CAAC,OAAO,EAAE,CAAC;YACb,MAAM,IAAI,KAAK,CAAC,sBAAsB,CAAC,CAAC;QAC1C,CAAC;QAED,MAAM,YAAY,GAAG,IAAI,0BAAY,CAAC,MAAM,CAAC,CAAC;QAC9C,MAAM,EAAE,GAAG,IAAI,gBAAgB,CAAU,OAAO,CAAC,CAAC;QAClD,EAAE,CAAC,OAAO,GAAG,YAAY,CAAC,SAAS,EAAE,CAAC;QAEtC,mDAAmD;QACnD,+EAA+E;QAC/E,EAAE,CAAC,YAAY,GAAG,EAAE,CAAC,OAAO,KAAK,EAAE,CAAC,CAAC,iCAAiC;QACtE,EAAE,CAAC,OAAO,GAAG,EAAE,CAAC,OAAO,GAAG,WAAW,CAAC,CAAC,mBAAmB;QAC1D,EAAE,CAAC,iBAAiB,GAAG,qCAAqC,CAAC,OAAO,EAAE,EAAE,CAAC,OAAO,CAAC,CAAC;QAElF,IAAI,EAAE,CAAC,sBAAsB,EAAE,EAAE,CAAC;YAChC,EAAE,CAAC,cAAc,GAAG,YAAY,CAAC,UAAU,EAAE,CAAC;QAChD,CAAC;QAED,IAAI,EAAE,CAAC,OAAO,KAAK,CAAC,EAAE,CAAC;YACrB,IAAA,+BAAY,EAAC,YAAY,EAAE,EAAE,EAAE,UAAU,CAAC,CAAC;QAC7C,CAAC;aAAM,CAAC;YACN,IAAA,+BAAY,EAAC,YAAY,EAAE,EAAE,EAAE,UAAU,CAAC,CAAC;QAC7C,CAAC;QAED,IAAI,UAAU;YAAE,OAAO,EAAE,CAAC;QAC1B,IAAI,YAAY,CAAC,MAAM,KAAK,MAAM,CAAC,MAAM,EAAE,CAAC;YAC1C,MAAM,QAAQ,GAAG,MAAM,CAAC,KAAK,CAAC,YAAY,CAAC,MAAM,CAAC,CAAC;YACnD,MAAM,IAAI,KAAK,CAAC,8BAA8B,QAAQ,CAAC,QAAQ,CAAC,KAAK,CAAC,EAAE,CAAC,CAAC;QAC5E,CAAC;QAED,OAAO,EAAE,CAAC;IACZ,CAAC;IAED,MAAM,CAAC,qBAAqB,CAC1B,GAAW,EACX,OAAqB,EACrB,OAAgB,EAChB,aAAkC,QAAQ;QAE1C,MAAM,EAAE,GAAG,gBAAgB,CAAC,UAAU,CAAU,GAAG,EAAE,KAAK,EAAE,UAAU,EAAE,OAAO,CAAC,CAAC;QACjF,IAAI,OAAO,EAAE,CAAC;YACZ,EAAE,CAAC,iBAAiB,GAAG,qCAAqC,CAAC,OAAO,EAAE,OAAO,CAAC,CAAC;QACjF,CAAC;QACD,OAAO,EAAE,CAAC;IACZ,CAAC;IAED,UAAU;QACR,IAAI,UAAU,GAAG,KAAK,CAAC,UAAU,EAAE,CAAC;QACpC,IAAI,IAAI,CAAC,sBAAsB,EAAE,EAAE,CAAC;YAClC,UAAU,IAAI,CAAC,CAAC,CAAC,kBAAkB;QACrC,CAAC;QACD,IAAI,IAAI,CAAC,sBAAsB,EAAE,EAAE,CAAC;YAClC,UAAU,IAAI,CAAC,CAAC,CAAC,gBAAgB;QACnC,CAAC;QACD,MAAM,iBAAiB,GAAG,OAAO,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC;QACpD,IAAI,IAAI,CAAC,OAAO,KAAK,CAAC,EAAE,CAAC;YACvB,+EAA+E;YAC/E,UAAU,IAAI,CAAC,CAAC,CAAC,oBAAoB;YACrC,UAAU,IAAI,iBAAiB,CAAC,CAAC,uBAAuB;YACxD,UAAU,IAAI,iBAAiB,CAAC,CAAC,wBAAwB;YACzD,UAAU,IAAI,CAAC,CAAC,CAAC,wBAAwB;QAC3C,CAAC;aAAM,CAAC;YACN,IAAI,IAAI,CAAC,mBAAmB,EAAE,EAAE,CAAC;gBAC/B,+EAA+E;gBAC/E,UAAU,IAAI,CAAC,CAAC,CAAC,wBAAwB;gBACzC,UAAU,IAAI,iBAAiB,CAAC,CAAC,SAAS;gBAC1C,UAAU,IAAI,iBAAiB,CAAC,CAAC,UAAU;YAC7C,CAAC;YACD,IAAI,IAAI,CAAC,kBAAkB,EAAE,EAAE,CAAC;gBAC9B,EAAE;gBACF,UAAU,IAAI,iBAAiB,CAAC,CAAC,aAAa;YAChD,CAAC;QACH,CAAC;QACD,OAAO,UAAU,CAAC;IACpB,CAAC;IAED,mBAAmB;QACjB,OAAO,CAAC,CAAC,IAAI,CAAC,YAAY,IAAI,IAAI,CAAC,OAAO,IAAI,gBAAgB,CAAC,eAAe,CAAC;IACjF,CAAC;IAED,sBAAsB;QACpB,OAAO,CAAC,CAAC,IAAI,CAAC,YAAY,IAAI,IAAI,CAAC,OAAO,IAAI,gBAAgB,CAAC,kBAAkB,CAAC;IACpF,CAAC;IAED,kBAAkB;QAChB,OAAO,CAAC,CAAC,IAAI,CAAC,YAAY,IAAI,IAAI,CAAC,OAAO,IAAI,gBAAgB,CAAC,0BAA0B,CAAC;IAC5F,CAAC;IAED;;;;OAIG;IACH,cAAc,CAAC,QAAgB;QAC7B,IAAI,CAAC,CAAC,QAAQ,GAAG,2BAAW,CAAC,oBAAoB,CAAC,EAAE,CAAC;YACnD,MAAM,YAAY,GAAG,IAAI,0BAAY,CAAC,MAAM,CAAC,WAAW,CAAC,EAAE,GAAG,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC,CAAC;YAEhF,IAAI,CAAC,GAAG,CAAC,OAAO,CAAC,UAAU,IAAI;gBAC7B,YAAY,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;gBACnC,YAAY,CAAC,WAAW,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;YACvC,CAAC,CAAC,CAAC;YAEH,OAAO,IAAA,4BAAc,EAAC,YAAY,CAAC,MAAM,EAAE,kBAAkB,CAAC,CAAC;QACjE,CAAC;QACD,OAAO,IAAI,CAAC;IACd,CAAC;IAED;;;;OAIG;IACH,eAAe,CAAC,QAAgB;QAC9B,IACE,CAAC,CAAC,QAAQ,GAAG,2BAAW,CAAC,oBAAoB,CAAC;YAC9C,CAAC,QAAQ,GAAG,IAAI,CAAC,KAAK,2BAAW,CAAC,cAAc;YAChD,CAAC,QAAQ,GAAG,IAAI,CAAC,KAAK,2BAAW,CAAC,YAAY,EAC9C,CAAC;YACD,MAAM,YAAY,GAAG,IAAI,0BAAY,CAAC,MAAM,CAAC,WAAW,CAAC,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC,CAAC;YAE/E,IAAI,CAAC,GAAG,CAAC,OAAO,CAAC,UAAU,IAAI;gBAC7B,YAAY,CAAC,WAAW,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;YAC1C,CAAC,CAAC,CAAC;YAEH,OAAO,IAAA,4BAAc,EAAC,YAAY,CAAC,MAAM,EAAE,kBAAkB,CAAC,CAAC;QACjE,CAAC;QACD,OAAO,IAAI,CAAC;IACd,CAAC;IAED;;;;;OAKG;IACH,cAAc,CAAC,QAAgB,EAAE,OAAe;QAC9C,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,KAAK,2BAAW,CAAC,cAAc,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,KAAK,2BAAW,CAAC,YAAY,EAAE,CAAC;YACvG,kDAAkD;YAClD,MAAM,UAAU,GAAG,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,UAAU,GAAG,EAAE,MAAM;gBACvD,OAAO,GAAG,GAAG,CAAC,GAAG,IAAA,8BAAY,EAAC,MAAM,CAAC,MAAM,CAAC,CAAC;YAC/C,CAAC,EAAE,CAAC,CAAC,CAAC;YAEN,MAAM,YAAY,GAAG,IAAI,0BAAY,CAAC,MAAM,CAAC,WAAW,CAAC,UAAU,CAAC,CAAC,CAAC;YAEtE,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,UAAU,GAAG;gBAC7B,YAAY,CAAC,WAAW,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;gBACpC,YAAY,CAAC,aAAa,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;YACzC,CAAC,CAAC,CAAC;YAEH,OAAO,IAAA,4BAAc,EAAC,YAAY,CAAC,MAAM,EAAE,kBAAkB,CAAC,CAAC;QACjE,CAAC;aAAM,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,KAAK,2BAAW,CAAC,cAAc,IAAI,OAAO,GAAG,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE,CAAC;YAC1F,6CAA6C;YAC7C,MAAM,MAAM,GAAG,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;YAElC,MAAM,YAAY,GAAG,IAAI,0BAAY,CAAC,MAAM,CAAC,WAAW,CAAC,CAAC,GAAG,IAAA,8BAAY,EAAC,MAAM,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;YAC3F,YAAY,CAAC,WAAW,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;YACvC,YAAY,CAAC,aAAa,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC;YAE1C,OAAO,IAAA,4BAAc,EAAC,YAAY,CAAC,MAAM,EAAE,kBAAkB,CAAC,CAAC;QACjE,CAAC;QACD,OAAO,IAAI,CAAC;IACd,CAAC;IAED;;;;;;;OAOG;IACH,yBAAyB,CACvB,OAA2B,EAC3B,aAAqB,EACrB,KAAkC,EAClC,QAAgB;QAEhB,IAAI,KAAK,KAAK,SAAS,EAAE,CAAC;YACxB,MAAM,IAAI,KAAK,CAAC,oBAAoB,CAAC,CAAC;QACxC,CAAC;QAED,8EAA8E;QAC9E,IAAI,IAAI,CAAC,OAAO,KAAK,CAAC,EAAE,CAAC;YACvB,OAAO,IAAA,gCAAkB,EAAC,IAAI,EAAE,OAAO,EAAE,aAAa,EAAE,KAAK,EAAE,QAAQ,CAAC,CAAC;QAC3E,CAAC;QAED,0DAA0D;QAC1D,KAAK,GAAG,OAAO,KAAK,KAAK,QAAQ,CAAC,CAAC,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC;QAC1D,SAAS,CAAC,KAAK,CAAC,KAAK,CAAC,KAAK,CAAC,MAAM,EAAE,KAAK,CAAC,MAAM,EAAE,KAAK,CAAC,MAAM,CAAC,EAAE,CAAC,OAAO,EAAE,aAAa,EAAE,KAAK,CAAC,CAAC,CAAC;QAElG,IAAI,OAAO,KAAK,SAAS,EAAE,CAAC;YAC1B,MAAM,IAAI,KAAK,CAAC,iBAAiB,CAAC,CAAC;QACrC,CAAC;QAED,0BAA0B;QAC1B,IAAI,OAAO,IAAI,IAAI,CAAC,GAAG,CAAC,MAAM,EAAE,CAAC;YAC/B,MAAM,IAAI,KAAK,CAAC,6BAA6B,CAAC,CAAC;QACjD,CAAC;QAED,0BAA0B;QAC1B,IAAI,CAAC,IAAI,CAAC,sBAAsB,EAAE,EAAE,CAAC;YACnC,MAAM,IAAI,KAAK,CAAC,uBAAuB,IAAI,CAAC,OAAO,EAAE,CAAC,CAAC;QACzD,CAAC;QAED,MAAM,YAAY,GAAG,IAAI,CAAC,cAAc,CAAC,QAAQ,CAAC,CAAC;QACnD,MAAM,YAAY,GAAG,IAAI,CAAC,eAAe,CAAC,QAAQ,CAAC,CAAC;QACpD,MAAM,WAAW,GAAG,IAAI,CAAC,cAAc,CAAC,QAAQ,EAAE,OAAO,CAAC,CAAC;QAC3D,MAAM,cAAc,GAAG,IAAI,CAAC;QAC5B,MAAM,kBAAkB,GAAG,IAAI,CAAC;QAChC,MAAM,mBAAmB,GAAG,IAAI,CAAC;QAEjC,IAAI,cAAc,GAAG,CAAC,CAAC;QACvB,cAAc,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,8DAA8D;QACvF,cAAc,IAAI,EAAE,GAAG,CAAC,CAAC,CAAC,sEAAsE;QAChG,cAAc,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,8BAA8B;QACvD,cAAc,IAAI,CAAC,CAAC,CAAC,QAAQ;QAC7B,cAAc,IAAI,EAAE,CAAC,CAAC,aAAa;QACnC,cAAc,IAAI,IAAA,8BAAY,EAAC,aAAa,CAAC,CAAC,CAAC,gBAAgB;QAC/D,IAAI,IAAI,CAAC,mBAAmB,EAAE,EAAE,CAAC;YAC/B,cAAc,IAAI,EAAE,GAAG,CAAC,CAAC,CAAC,6CAA6C;YACvE,cAAc,IAAI,CAAC,CAAC,CAAC,eAAe;QACtC,CAAC;QAED,MAAM,IAAI,GAAG,IAAI,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;QACvC,MAAM,MAAM,GAAG,IAAI,CAAC,OAAO,GAAG,CAAC,IAAI,IAAI,EAAE,CAAC,CAAC;QAE3C,MAAM,YAAY,GAAG,IAAI,0BAAY,CAAC,MAAM,CAAC,KAAK,CAAC,cAAc,CAAC,CAAC,CAAC;QACpE,YAAY,CAAC,UAAU,CAAC,MAAM,CAAC,CAAC;QAChC,YAAY,CAAC,WAAW,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC;QAC9C,YAAY,CAAC,UAAU,CAAC,YAAY,CAAC,CAAC;QACtC,YAAY,CAAC,UAAU,CAAC,YAAY,CAAC,CAAC;QACtC,YAAY,CAAC,UAAU,CAAC,WAAW,CAAC,CAAC;QACrC,YAAY,CAAC,UAAU,CAAC,cAAc,CAAC,CAAC;QACxC,IAAI,IAAI,CAAC,mBAAmB,EAAE,EAAE,CAAC;YAC/B,YAAY,CAAC,UAAU,CAAC,kBAAkB,CAAC,CAAC;YAC5C,YAAY,CAAC,UAAU,CAAC,mBAAmB,CAAC,CAAC;QAC/C,CAAC;QACD,YAAY,CAAC,WAAW,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;QACxC,YAAY,CAAC,WAAW,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;QAC5C,IAAI,IAAI,CAAC,mBAAmB,EAAE,EAAE,CAAC;YAC/B,YAAY,CAAC,UAAU,CAAC,mCAAgB,CAAC,CAAC;QAC5C,CAAC;QACD,YAAY,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC;QAElC,4EAA4E;QAC5E,yEAAyE;QACzE,4CAA4C;QAC5C,MAAM,KAAK,GAAG,IAAI,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;QAChC,YAAY,CAAC,UAAU,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;QACpC,YAAY,CAAC,WAAW,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;QACtC,YAAY,CAAC,aAAa,CAAC,aAAa,CAAC,CAAC;QAC1C,YAAY,CAAC,WAAW,CAAC,KAAK,CAAC,CAAC;QAChC,YAAY,CAAC,WAAW,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC;QAEzC,MAAM,eAAe,GAAG,MAAM,CAAC,KAAK,CAAC,EAAE,CAAC,CAAC;QACzC,MAAM,MAAM,GAAG,cAAc,CAAC;QAC9B,eAAe,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC;QAC9B,eAAe,CAAC,aAAa,CAAC,IAAI,CAAC,iBAAiB,EAAE,MAAM,CAAC,MAAM,CAAC,CAAC;QAErE,OAAO,IAAA,4BAAc,EAAC,YAAY,CAAC,MAAM,EAAE,eAAe,CAAC,CAAC;IAC9D,CAAC;IAED,QAAQ,CAAC,MAAe,EAAE,aAAa,GAAG,CAAC;QACzC,IAAI,CAAC,MAAM;YAAE,MAAM,GAAG,MAAM,CAAC,WAAW,CAAC,IAAI,CAAC,UAAU,EAAE,CAAC,CAAC;QAE5D,MAAM,YAAY,GAAG,IAAI,0BAAY,CAAC,MAAM,EAAE,aAAa,CAAC,CAAC;QAE7D,IAAI,IAAI,CAAC,sBAAsB,EAAE,EAAE,CAAC;YAClC,MAAM,IAAI,GAAG,IAAI,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;YACvC,YAAY,CAAC,UAAU,CAAC,IAAI,CAAC,OAAO,GAAG,CAAC,IAAI,IAAI,EAAE,CAAC,CAAC,CAAC,CAAC,qBAAqB;YAC3E,YAAY,CAAC,WAAW,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC;QAChD,CAAC;aAAM,CAAC;YACN,YAAY,CAAC,UAAU,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;QACxC,CAAC;QAED,IAAI,IAAI,CAAC,OAAO,KAAK,CAAC,EAAE,CAAC;YACvB,IAAA,6BAAU,EAAC,YAAY,EAAE,IAAI,CAAC,CAAC;QACjC,CAAC;aAAM,CAAC;YACN,IAAA,6BAAU,EAAC,YAAY,EAAE,IAAI,CAAC,CAAC;QACjC,CAAC;QAED,IAAI,aAAa,KAAK,SAAS,EAAE,CAAC;YAChC,OAAO,MAAM,CAAC,KAAK,CAAC,aAAa,EAAE,YAAY,CAAC,MAAM,CAAC,CAAC;QAC1D,CAAC;QACD,OAAO,MAAM,CAAC;IAChB,CAAC;IAED,OAAO,CAAC,UAAoB;QAC1B,IAAI,UAAU,EAAE,CAAC;YACf,MAAM,IAAI,KAAK,CAAC,kBAAkB,CAAC,CAAC;QACtC,CAAC;QACD,IAAI,IAAI,CAAC,OAAO,KAAK,CAAC,EAAE,CAAC;YACvB,OAAO,IAAA,2BAAa,EAAC,IAAI,CAAC,CAAC;QAC7B,CAAC;QACD,OAAO,sBAAM,CAAC,OAAO,CAAC,IAAI,CAAC,QAAQ,EAAE,CAAC,CAAC;IACzC,CAAC;IAED,KAAK,CAAwC,UAAgC;QAC3E,OAAO,IAAI,gBAAgB,CAAM,IAAI,CAAC,OAAO,EAAE,IAAI,EAAE,UAAU,CAAC,CAAC;IACnE,CAAC;;AArVH,4CAsVC;AArVQ,2CAA0B,GAAG,CAAC,AAAJ,CAAK;AAC/B,mCAAkB,GAAG,CAAC,AAAJ,CAAK;AACvB,gCAAe,GAAG,CAAC,AAAJ,CAAK;AAEpB,uCAAsB,GAAG,GAAG,AAAN,CAAO;AAC7B,oCAAmB,GAAG,GAAG,AAAN,CAAO;AAC1B,oCAAmB,GAAG,GAAG,AAAN,CAAO;AAC1B,oCAAmB,GAAG,GAAG,AAAN,CAAO;AAC1B,oCAAmB,GAAG,GAAG,AAAN,CAAO","sourcesContent":["import { Transaction, crypto } from 'bitcoinjs-lib';\nimport * as types from 'bitcoinjs-lib/src/types';\nimport { BufferReader, BufferWriter } from 'bitcoinjs-lib/src/bufferutils';\n\nconst varuint = require('varuint-bitcoin');\nconst typeforce = require('typeforce');\n\nimport { networks } from '../../networks';\nimport { UtxoTransaction, varSliceSize } from '../UtxoTransaction';\nimport { fromBufferV4, fromBufferV5, toBufferV4, toBufferV5, VALUE_INT64_ZERO } from './ZcashBufferutils';\nimport { getBlake2bHash, getSignatureDigest, getTxidDigest } from './hashZip0244';\n\nconst ZERO = Buffer.from('0000000000000000000000000000000000000000000000000000000000000000', 'hex');\n\nexport type ZcashNetwork = typeof networks.zcash | typeof networks.zcashTest;\n\n// https://github.com/zcash/zcash/blob/v4.7.0/src/primitives/transaction.h#L40\nconst SAPLING_VERSION_GROUP_ID = 0x892f2085;\n// https://github.com/zcash/zcash/blob/v4.7.0/src/primitives/transaction.h#L52\nconst ZIP225_VERSION_GROUP_ID = 0x26a7270a;\n\n// https://github.com/zcash/zcash/blob/v4.7.0/src/consensus/upgrades.cpp#L11\nconst OVERWINTER_BRANCH_ID = 0x5ba81b19;\nconst CANOPY_BRANCH_ID = 0xe9ff75a6;\nconst NU5_BRANCH_ID = 0xc2d6d0b4;\nconst NU6_BRANCH_ID = 0xc8e71055;\n\nexport class UnsupportedTransactionError extends Error {\n  constructor(message: string) {\n    super(message);\n  }\n}\n\nexport function getDefaultVersionGroupIdForVersion(version: number): number {\n  switch (version) {\n    case 400:\n    case 450:\n    case 455:\n      return SAPLING_VERSION_GROUP_ID;\n    case 500:\n    case 550:\n      return ZIP225_VERSION_GROUP_ID;\n  }\n  throw new Error(`no value for version ${version}`);\n}\n\nexport function getDefaultConsensusBranchIdForVersion(network: ZcashNetwork, version: number): number {\n  switch (version) {\n    case 1:\n    case 2:\n      return 0;\n    case 3:\n      return OVERWINTER_BRANCH_ID;\n    case ZcashTransaction.VERSION4_BRANCH_CANOPY:\n      // https://zips.z.cash/zip-0251\n      return CANOPY_BRANCH_ID;\n    case ZcashTransaction.VERSION4_BRANCH_NU5:\n    case ZcashTransaction.VERSION5_BRANCH_NU5:\n      // https://zips.z.cash/zip-0252\n      // NU5 is deprecated on mainnet on block 2726400\n      return NU5_BRANCH_ID;\n    case 4:\n    case 5:\n    case ZcashTransaction.VERSION4_BRANCH_NU6:\n    case ZcashTransaction.VERSION5_BRANCH_NU6:\n      // https://zips.z.cash/zip-0253\n      return NU6_BRANCH_ID;\n  }\n  throw new Error(`no value for version ${version}`);\n}\n\nexport class ZcashTransaction<TNumber extends number | bigint = number> extends UtxoTransaction<TNumber> {\n  static VERSION_JOINSPLITS_SUPPORT = 2;\n  static VERSION_OVERWINTER = 3;\n  static VERSION_SAPLING = 4;\n\n  static VERSION4_BRANCH_CANOPY = 400;\n  static VERSION4_BRANCH_NU5 = 450;\n  static VERSION4_BRANCH_NU6 = 455;\n  static VERSION5_BRANCH_NU5 = 500;\n  static VERSION5_BRANCH_NU6 = 550;\n\n  // 1 if the transaction is post overwinter upgrade, 0 otherwise\n  overwintered = 0;\n  // 0x03C48270 (63210096) for overwinter and 0x892F2085 (2301567109) for sapling\n  versionGroupId = 0;\n  // Block height after which this transactions will expire, or 0 to disable expiry\n  expiryHeight = 0;\n  consensusBranchId: number;\n\n  constructor(public network: ZcashNetwork, tx?: ZcashTransaction<bigint | number>, amountType?: 'bigint' | 'number') {\n    super(network, tx, amountType);\n\n    let consensusBranchId;\n    if (tx) {\n      this.overwintered = tx.overwintered;\n      this.versionGroupId = tx.versionGroupId;\n      this.expiryHeight = tx.expiryHeight;\n\n      if (tx.consensusBranchId !== undefined) {\n        consensusBranchId = tx.consensusBranchId;\n      }\n    }\n    this.consensusBranchId = consensusBranchId ?? getDefaultConsensusBranchIdForVersion(network, this.version);\n  }\n\n  static fromBuffer<TNumber extends number | bigint = number>(\n    buffer: Buffer,\n    __noStrict: boolean,\n    amountType: 'number' | 'bigint' = 'number',\n    network?: ZcashNetwork\n  ): ZcashTransaction<TNumber> {\n    /* istanbul ignore next */\n    if (!network) {\n      throw new Error(`must provide network`);\n    }\n\n    const bufferReader = new BufferReader(buffer);\n    const tx = new ZcashTransaction<TNumber>(network);\n    tx.version = bufferReader.readInt32();\n\n    // Split the header into fOverwintered and nVersion\n    // https://github.com/zcash/zcash/blob/v4.5.1/src/primitives/transaction.h#L772\n    tx.overwintered = tx.version >>> 31; // Must be 1 for version 3 and up\n    tx.version = tx.version & 0x07fffffff; // 3 for overwinter\n    tx.consensusBranchId = getDefaultConsensusBranchIdForVersion(network, tx.version);\n\n    if (tx.isOverwinterCompatible()) {\n      tx.versionGroupId = bufferReader.readUInt32();\n    }\n\n    if (tx.version === 5) {\n      fromBufferV5(bufferReader, tx, amountType);\n    } else {\n      fromBufferV4(bufferReader, tx, amountType);\n    }\n\n    if (__noStrict) return tx;\n    if (bufferReader.offset !== buffer.length) {\n      const trailing = buffer.slice(bufferReader.offset);\n      throw new Error(`Unexpected trailing bytes: ${trailing.toString('hex')}`);\n    }\n\n    return tx;\n  }\n\n  static fromBufferWithVersion<TNumber extends number | bigint>(\n    buf: Buffer,\n    network: ZcashNetwork,\n    version?: number,\n    amountType: 'number' | 'bigint' = 'number'\n  ): ZcashTransaction<TNumber> {\n    const tx = ZcashTransaction.fromBuffer<TNumber>(buf, false, amountType, network);\n    if (version) {\n      tx.consensusBranchId = getDefaultConsensusBranchIdForVersion(network, version);\n    }\n    return tx;\n  }\n\n  byteLength(): number {\n    let byteLength = super.byteLength();\n    if (this.isOverwinterCompatible()) {\n      byteLength += 4; // nVersionGroupId\n    }\n    if (this.isOverwinterCompatible()) {\n      byteLength += 4; // nExpiryHeight\n    }\n    const emptyVectorLength = varuint.encodingLength(0);\n    if (this.version === 5) {\n      // https://github.com/zcash/zcash/blob/v4.5.1/src/primitives/transaction.h#L822\n      byteLength += 4; // consensusBranchId\n      byteLength += emptyVectorLength; // saplingBundle inputs\n      byteLength += emptyVectorLength; // saplingBundle outputs\n      byteLength += 1; // orchardBundle (empty)\n    } else {\n      if (this.isSaplingCompatible()) {\n        // https://github.com/zcash/zcash/blob/v4.5.1/src/primitives/transaction.h#L862\n        byteLength += 8; // valueBalance (uint64)\n        byteLength += emptyVectorLength; // inputs\n        byteLength += emptyVectorLength; // outputs\n      }\n      if (this.supportsJoinSplits()) {\n        //\n        byteLength += emptyVectorLength; // joinsplits\n      }\n    }\n    return byteLength;\n  }\n\n  isSaplingCompatible(): boolean {\n    return !!this.overwintered && this.version >= ZcashTransaction.VERSION_SAPLING;\n  }\n\n  isOverwinterCompatible(): boolean {\n    return !!this.overwintered && this.version >= ZcashTransaction.VERSION_OVERWINTER;\n  }\n\n  supportsJoinSplits(): boolean {\n    return !!this.overwintered && this.version >= ZcashTransaction.VERSION_JOINSPLITS_SUPPORT;\n  }\n\n  /**\n   * Build a hash for all or none of the transaction inputs depending on the hashtype\n   * @param hashType\n   * @returns Buffer - BLAKE2b hash or 256-bit zero if doesn't apply\n   */\n  getPrevoutHash(hashType: number): Buffer {\n    if (!(hashType & Transaction.SIGHASH_ANYONECANPAY)) {\n      const bufferWriter = new BufferWriter(Buffer.allocUnsafe(36 * this.ins.length));\n\n      this.ins.forEach(function (txIn) {\n        bufferWriter.writeSlice(txIn.hash);\n        bufferWriter.writeUInt32(txIn.index);\n      });\n\n      return getBlake2bHash(bufferWriter.buffer, 'ZcashPrevoutHash');\n    }\n    return ZERO;\n  }\n\n  /**\n   * Build a hash for all or none of the transactions inputs sequence numbers depending on the hashtype\n   * @param hashType\n   * @returns Buffer BLAKE2b hash or 256-bit zero if doesn't apply\n   */\n  getSequenceHash(hashType: number): Buffer {\n    if (\n      !(hashType & Transaction.SIGHASH_ANYONECANPAY) &&\n      (hashType & 0x1f) !== Transaction.SIGHASH_SINGLE &&\n      (hashType & 0x1f) !== Transaction.SIGHASH_NONE\n    ) {\n      const bufferWriter = new BufferWriter(Buffer.allocUnsafe(4 * this.ins.length));\n\n      this.ins.forEach(function (txIn) {\n        bufferWriter.writeUInt32(txIn.sequence);\n      });\n\n      return getBlake2bHash(bufferWriter.buffer, 'ZcashSequencHash');\n    }\n    return ZERO;\n  }\n\n  /**\n   * Build a hash for one, all or none of the transaction outputs depending on the hashtype\n   * @param hashType\n   * @param inIndex\n   * @returns Buffer BLAKE2b hash or 256-bit zero if doesn't apply\n   */\n  getOutputsHash(hashType: number, inIndex: number): Buffer {\n    if ((hashType & 0x1f) !== Transaction.SIGHASH_SINGLE && (hashType & 0x1f) !== Transaction.SIGHASH_NONE) {\n      // Find out the size of the outputs and write them\n      const txOutsSize = this.outs.reduce(function (sum, output) {\n        return sum + 8 + varSliceSize(output.script);\n      }, 0);\n\n      const bufferWriter = new BufferWriter(Buffer.allocUnsafe(txOutsSize));\n\n      this.outs.forEach(function (out) {\n        bufferWriter.writeUInt64(out.value);\n        bufferWriter.writeVarSlice(out.script);\n      });\n\n      return getBlake2bHash(bufferWriter.buffer, 'ZcashOutputsHash');\n    } else if ((hashType & 0x1f) === Transaction.SIGHASH_SINGLE && inIndex < this.outs.length) {\n      // Write only the output specified in inIndex\n      const output = this.outs[inIndex];\n\n      const bufferWriter = new BufferWriter(Buffer.allocUnsafe(8 + varSliceSize(output.script)));\n      bufferWriter.writeUInt64(output.value);\n      bufferWriter.writeVarSlice(output.script);\n\n      return getBlake2bHash(bufferWriter.buffer, 'ZcashOutputsHash');\n    }\n    return ZERO;\n  }\n\n  /**\n   * Hash transaction for signing a transparent transaction in Zcash. Protected transactions are not supported.\n   * @param inIndex\n   * @param prevOutScript\n   * @param value\n   * @param hashType\n   * @returns Buffer BLAKE2b hash\n   */\n  hashForSignatureByNetwork(\n    inIndex: number | undefined,\n    prevOutScript: Buffer,\n    value: bigint | number | undefined,\n    hashType: number\n  ): Buffer {\n    if (value === undefined) {\n      throw new Error(`must provide value`);\n    }\n\n    // https://github.com/zcash/zcash/blob/v4.5.1/src/script/interpreter.cpp#L1175\n    if (this.version === 5) {\n      return getSignatureDigest(this, inIndex, prevOutScript, value, hashType);\n    }\n\n    // ZCash amounts are always within Number.MAX_SAFE_INTEGER\n    value = typeof value === 'bigint' ? Number(value) : value;\n    typeforce(types.tuple(types.UInt32, types.Buffer, types.Number), [inIndex, prevOutScript, value]);\n\n    if (inIndex === undefined) {\n      throw new Error(`invalid inIndex`);\n    }\n\n    /* istanbul ignore next */\n    if (inIndex >= this.ins.length) {\n      throw new Error('Input index is out of range');\n    }\n\n    /* istanbul ignore next */\n    if (!this.isOverwinterCompatible()) {\n      throw new Error(`unsupported version ${this.version}`);\n    }\n\n    const hashPrevouts = this.getPrevoutHash(hashType);\n    const hashSequence = this.getSequenceHash(hashType);\n    const hashOutputs = this.getOutputsHash(hashType, inIndex);\n    const hashJoinSplits = ZERO;\n    const hashShieldedSpends = ZERO;\n    const hashShieldedOutputs = ZERO;\n\n    let baseBufferSize = 0;\n    baseBufferSize += 4 * 5; // header, nVersionGroupId, lock_time, nExpiryHeight, hashType\n    baseBufferSize += 32 * 4; // 256 hashes: hashPrevouts, hashSequence, hashOutputs, hashJoinSplits\n    baseBufferSize += 4 * 2; // input.index, input.sequence\n    baseBufferSize += 8; // value\n    baseBufferSize += 32; // input.hash\n    baseBufferSize += varSliceSize(prevOutScript); // prevOutScript\n    if (this.isSaplingCompatible()) {\n      baseBufferSize += 32 * 2; // hashShieldedSpends and hashShieldedOutputs\n      baseBufferSize += 8; // valueBalance\n    }\n\n    const mask = this.overwintered ? 1 : 0;\n    const header = this.version | (mask << 31);\n\n    const bufferWriter = new BufferWriter(Buffer.alloc(baseBufferSize));\n    bufferWriter.writeInt32(header);\n    bufferWriter.writeUInt32(this.versionGroupId);\n    bufferWriter.writeSlice(hashPrevouts);\n    bufferWriter.writeSlice(hashSequence);\n    bufferWriter.writeSlice(hashOutputs);\n    bufferWriter.writeSlice(hashJoinSplits);\n    if (this.isSaplingCompatible()) {\n      bufferWriter.writeSlice(hashShieldedSpends);\n      bufferWriter.writeSlice(hashShieldedOutputs);\n    }\n    bufferWriter.writeUInt32(this.locktime);\n    bufferWriter.writeUInt32(this.expiryHeight);\n    if (this.isSaplingCompatible()) {\n      bufferWriter.writeSlice(VALUE_INT64_ZERO);\n    }\n    bufferWriter.writeInt32(hashType);\n\n    // The input being signed (replacing the scriptSig with scriptCode + amount)\n    // The prevout may already be contained in hashPrevout, and the nSequence\n    // may already be contained in hashSequence.\n    const input = this.ins[inIndex];\n    bufferWriter.writeSlice(input.hash);\n    bufferWriter.writeUInt32(input.index);\n    bufferWriter.writeVarSlice(prevOutScript);\n    bufferWriter.writeUInt64(value);\n    bufferWriter.writeUInt32(input.sequence);\n\n    const personalization = Buffer.alloc(16);\n    const prefix = 'ZcashSigHash';\n    personalization.write(prefix);\n    personalization.writeUInt32LE(this.consensusBranchId, prefix.length);\n\n    return getBlake2bHash(bufferWriter.buffer, personalization);\n  }\n\n  toBuffer(buffer?: Buffer, initialOffset = 0): Buffer {\n    if (!buffer) buffer = Buffer.allocUnsafe(this.byteLength());\n\n    const bufferWriter = new BufferWriter(buffer, initialOffset);\n\n    if (this.isOverwinterCompatible()) {\n      const mask = this.overwintered ? 1 : 0;\n      bufferWriter.writeInt32(this.version | (mask << 31)); // Set overwinter bit\n      bufferWriter.writeUInt32(this.versionGroupId);\n    } else {\n      bufferWriter.writeInt32(this.version);\n    }\n\n    if (this.version === 5) {\n      toBufferV5(bufferWriter, this);\n    } else {\n      toBufferV4(bufferWriter, this);\n    }\n\n    if (initialOffset !== undefined) {\n      return buffer.slice(initialOffset, bufferWriter.offset);\n    }\n    return buffer;\n  }\n\n  getHash(forWitness?: boolean): Buffer {\n    if (forWitness) {\n      throw new Error(`invalid argument`);\n    }\n    if (this.version === 5) {\n      return getTxidDigest(this);\n    }\n    return crypto.hash256(this.toBuffer());\n  }\n\n  clone<TN2 extends number | bigint = TNumber>(amountType?: 'bigint' | 'number'): ZcashTransaction<TN2> {\n    return new ZcashTransaction<TN2>(this.network, this, amountType);\n  }\n}\n"]}