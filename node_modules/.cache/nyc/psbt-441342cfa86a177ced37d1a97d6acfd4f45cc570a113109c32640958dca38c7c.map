{"version":3,"file":"/Users/qroc/Code/hapi/chaindefuser/utxo-lib/src/testutil/psbt.ts","sources":["/Users/qroc/Code/hapi/chaindefuser/utxo-lib/src/testutil/psbt.ts"],"names":[],"mappings":"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","sourcesContent":["import * as assert from 'assert';\n\nimport {\n  createOutputScriptP2shP2pk,\n  ScriptType,\n  ScriptType2Of3,\n  scriptTypeP2shP2pk,\n  scriptTypes2Of3,\n} from '../bitgo/outputScripts';\nimport {\n  addReplayProtectionUnspentToPsbt,\n  addWalletOutputToPsbt,\n  addWalletUnspentToPsbt,\n  createPsbtForNetwork,\n  getExternalChainCode,\n  getInternalChainCode,\n  getSignatureVerifications,\n  isWalletUnspent,\n  KeyName,\n  parseSignatureScript2Of3,\n  RootWalletKeys,\n  toOutput,\n  Unspent,\n  UtxoPsbt,\n  UtxoTransaction,\n  verifySignatureWithUnspent,\n  withUnsafeNonSegwit,\n} from '../bitgo';\nimport { Network } from '../networks';\nimport { mockReplayProtectionUnspent, mockWalletUnspent } from './mock';\nimport { toOutputScript } from '../address';\n\n/**\n * input script type and value.\n * use p2trMusig2 for p2trMusig2 script path.\n * use taprootKeyPathSpend for p2trMusig2 key path.\n */\nexport type InputScriptType = ScriptType | 'taprootKeyPathSpend';\nexport type OutputScriptType = ScriptType2Of3;\n\n/**\n * input script type and value\n */\nexport type Input = {\n  scriptType: InputScriptType;\n  value: bigint;\n};\n\n/**\n * Set isInternalAddress=true for internal output address\n */\n// Make script: string as instead of scriptType or address\nexport type Output = {\n  value: bigint;\n  isInternalAddress?: boolean;\n} & ({ scriptType: OutputScriptType } | { address: string } | { script: string });\n\n/**\n * array of supported input script types.\n * use p2trMusig2 for p2trMusig2 script path.\n * use taprootKeyPathSpend for p2trMusig2 key path.\n */\nexport const inputScriptTypes = [...scriptTypes2Of3, 'taprootKeyPathSpend', scriptTypeP2shP2pk] as const;\n\n/**\n * array of supported output script types.\n */\nexport const outputScriptTypes = scriptTypes2Of3;\n\n/**\n * create unspent object from input script type, index, network and root wallet key.\n */\nexport function toUnspent(\n  input: Input,\n  index: number,\n  network: Network,\n  rootWalletKeys: RootWalletKeys\n): Unspent<bigint> {\n  if (input.scriptType === 'p2shP2pk') {\n    return mockReplayProtectionUnspent(network, input.value, { key: rootWalletKeys['user'], vout: index });\n  } else {\n    const chain = getInternalChainCode(input.scriptType === 'taprootKeyPathSpend' ? 'p2trMusig2' : input.scriptType);\n    return mockWalletUnspent(network, input.value, {\n      chain,\n      vout: index,\n      keys: rootWalletKeys,\n      index,\n    });\n  }\n}\n\n/**\n * returns signer and cosigner names for InputScriptType.\n * user and undefined as signer and cosigner respectively for p2shP2pk.\n * user and backup as signer and cosigner respectively for p2trMusig2.\n * user and bitgo as signer and cosigner respectively for other input script types.\n */\nexport function getSigners(inputType: InputScriptType): { signerName: KeyName; cosignerName?: KeyName } {\n  return {\n    signerName: 'user',\n    cosignerName: inputType === 'p2shP2pk' ? undefined : inputType === 'p2trMusig2' ? 'backup' : 'bitgo',\n  };\n}\n\n/**\n * signs with first or second signature for single input.\n * p2shP2pk is signed only with first sign.\n */\nexport function signPsbtInput(\n  psbt: UtxoPsbt,\n  input: Input,\n  inputIndex: number,\n  rootWalletKeys: RootWalletKeys,\n  sign: 'halfsigned' | 'fullsigned',\n  params?: {\n    signers?: { signerName: KeyName; cosignerName?: KeyName };\n    deterministic?: boolean;\n    skipNonWitnessUtxo?: boolean;\n  }\n): void {\n  function signPsbt(psbt: UtxoPsbt, signFunc: () => void, skipNonWitnessUtxo?: boolean) {\n    if (skipNonWitnessUtxo) {\n      withUnsafeNonSegwit(psbt, signFunc);\n    } else {\n      signFunc();\n    }\n  }\n\n  const { signers, deterministic, skipNonWitnessUtxo } = params ?? {};\n  const { signerName, cosignerName } = signers ? signers : getSigners(input.scriptType);\n  if (sign === 'halfsigned') {\n    if (input.scriptType === 'p2shP2pk') {\n      signPsbt(psbt, () => psbt.signInput(inputIndex, rootWalletKeys[signerName]), skipNonWitnessUtxo);\n    } else {\n      signPsbt(psbt, () => psbt.signInputHD(inputIndex, rootWalletKeys[signerName]), skipNonWitnessUtxo);\n    }\n  }\n  if (sign === 'fullsigned' && cosignerName && input.scriptType !== 'p2shP2pk') {\n    signPsbt(\n      psbt,\n      () => psbt.signInputHD(inputIndex, rootWalletKeys[cosignerName], { deterministic }),\n      skipNonWitnessUtxo\n    );\n  }\n}\n\n/**\n * signs with first or second signature for all inputs.\n * p2shP2pk is signed only with first sign.\n */\nexport function signAllPsbtInputs(\n  psbt: UtxoPsbt,\n  inputs: Input[],\n  rootWalletKeys: RootWalletKeys,\n  sign: 'halfsigned' | 'fullsigned',\n  params?: {\n    signers?: { signerName: KeyName; cosignerName?: KeyName };\n    deterministic?: boolean;\n    skipNonWitnessUtxo?: boolean;\n  }\n): void {\n  const { signers, deterministic, skipNonWitnessUtxo } = params ?? {};\n  inputs.forEach((input, inputIndex) => {\n    signPsbtInput(psbt, input, inputIndex, rootWalletKeys, sign, { signers, deterministic, skipNonWitnessUtxo });\n  });\n}\n\n/**\n * construct psbt for given inputs, outputs, network and root wallet keys.\n */\nexport function constructPsbt(\n  inputs: Input[],\n  outputs: Output[],\n  network: Network,\n  rootWalletKeys: RootWalletKeys,\n  sign: 'unsigned' | 'halfsigned' | 'fullsigned',\n  params?: {\n    signers?: { signerName: KeyName; cosignerName?: KeyName };\n    deterministic?: boolean;\n    skipNonWitnessUtxo?: boolean;\n  }\n): UtxoPsbt {\n  const { signers, deterministic, skipNonWitnessUtxo } = params ?? {};\n  const totalInputAmount = inputs.reduce((sum, input) => sum + input.value, BigInt(0));\n  const outputInputAmount = outputs.reduce((sum, output) => sum + output.value, BigInt(0));\n  assert(totalInputAmount >= outputInputAmount, 'total output can not exceed total input');\n\n  const psbt = createPsbtForNetwork({ network });\n  const unspents = inputs.map((input, i) => toUnspent(input, i, network, rootWalletKeys));\n\n  unspents.forEach((u, i) => {\n    const { signerName, cosignerName } = signers ? signers : getSigners(inputs[i].scriptType);\n    if (isWalletUnspent(u) && cosignerName) {\n      addWalletUnspentToPsbt(psbt, u, rootWalletKeys, signerName, cosignerName, { skipNonWitnessUtxo });\n    } else {\n      const { redeemScript } = createOutputScriptP2shP2pk(rootWalletKeys[signerName].publicKey);\n      assert(redeemScript);\n      addReplayProtectionUnspentToPsbt(psbt, u, redeemScript, { skipNonWitnessUtxo });\n    }\n  });\n\n  outputs.forEach((output, i) => {\n    if ('scriptType' in output) {\n      addWalletOutputToPsbt(\n        psbt,\n        rootWalletKeys,\n        output.isInternalAddress ? getInternalChainCode(output.scriptType) : getExternalChainCode(output.scriptType),\n        i,\n        output.value\n      );\n    } else if ('address' in output) {\n      const { address, value } = output;\n      psbt.addOutput({ script: toOutputScript(address, network), value });\n    } else if ('script' in output) {\n      const { script, value } = output;\n      psbt.addOutput({ script: Buffer.from(script, 'hex'), value });\n    }\n  });\n\n  if (sign === 'unsigned') {\n    return psbt;\n  }\n\n  psbt.setAllInputsMusig2NonceHD(rootWalletKeys['user']);\n  psbt.setAllInputsMusig2NonceHD(rootWalletKeys['bitgo'], { deterministic });\n\n  signAllPsbtInputs(psbt, inputs, rootWalletKeys, 'halfsigned', { signers, skipNonWitnessUtxo });\n\n  if (sign === 'fullsigned') {\n    signAllPsbtInputs(psbt, inputs, rootWalletKeys, sign, { signers, deterministic, skipNonWitnessUtxo });\n  }\n\n  return psbt;\n}\n\n/**\n * Verifies signatures of fully signed tx (with taproot key path support).\n * NOTE: taproot key path tx can only be built and signed with PSBT.\n */\nexport function verifyFullySignedSignatures(\n  tx: UtxoTransaction<bigint>,\n  unspents: Unspent<bigint>[],\n  walletKeys: RootWalletKeys,\n  signer: KeyName,\n  cosigner: KeyName\n): boolean {\n  const prevOutputs = unspents.map((u) => toOutput(u, tx.network));\n  return unspents.every((u, index) => {\n    if (parseSignatureScript2Of3(tx.ins[index]).scriptType === 'taprootKeyPathSpend') {\n      const result = getSignatureVerifications(tx, index, u.value, undefined, prevOutputs);\n      return result.length === 1 && result[0].signature;\n    } else {\n      const result = verifySignatureWithUnspent(tx, index, unspents, walletKeys);\n      if ((signer === 'user' && cosigner === 'bitgo') || (signer === 'bitgo' && cosigner === 'user')) {\n        return result[0] && !result[1] && result[2];\n      } else if ((signer === 'user' && cosigner === 'backup') || (signer === 'backup' && cosigner === 'user')) {\n        return result[0] && result[1] && !result[2];\n      } else {\n        return !result[0] && result[1] && result[2];\n      }\n    }\n  });\n}\n"]}